#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment/Direct_Switch_DiD")
# Read in DF
Rev <- read.csv("SALT_App_Merge_2024 copy.csv")
# Read in DF
Rev <- read.csv("SALT_App_Merge_2024.csv")
Rev2 <- Rev %>%
filter(c(year >=1976 & year <=2023))
View(Rev2)
NE_DiD <- Rev2 %>%
filter(c(State_Acronym= NE | State_Acronym=AK | State_Acronym=HI|State_Acronym=KS|State_Acronym=NM|State_Acronym=OK|State_Acronym=AL|State_Acronym=MT))
NE_DiD <- Rev2 %>%
filter(c(State_Acronym== NE | State_Acronym==AK | State_Acronym==HI|State_Acronym==KS|State_Acronym==NM|State_Acronym==OK|State_Acronym==AL|State_Acronym==MT))
NE_DiD <- Rev2 %>%
filter(c(Rev2$State_Acronym== NE | State_Acronym==AK | State_Acronym==HI|State_Acronym==KS|State_Acronym==NM|State_Acronym==OK|State_Acronym==AL|State_Acronym==MT))
rlang::last_trace()
NE_DiD <- Rev2 %>%
filter(c(State_Acronym== NE)
rlang::last_trace(drop = FALSE)
#Filter Rev 2 to just be NE with Control Group States
NE_DiD <- Rev2 %>%
filter(c(State_Acronym== NE)
NE_DiD <- Rev2 %>%
NE_DiD <- Rev2 %>%
filter(c(State_Acronym=="NE")
NE_DiD <- Rev2 %>%
NE_DiD <- Rev2 %>%
filter(State_Acronym=="NE")
View(NE_DiD)
NE_DiD <- Rev2 %>%
filter(State_Acronym=="NE"|State_Acronym=="AK")
View(NE_DiD)
NE_DiD <- Rev2 %>%
filter(State_Acronym=="NE"|State_Acronym=="AK"| State_Acronym=="HI"|State_Acronym=="KS"|State_Acronym=="NM"|State_Acronym=="OK"|State_Acronym=="AL"|State_Acronym=="MT")
View(NE_DiD)
Rev2 <- Rev %>%
filter(c(year >=1976 & year <=2022))
#Filter Rev 2 to just be NE with Control Group States
NE_DiD <- Rev2 %>%
filter(State_Acronym=="NE"|State_Acronym=="AK"| State_Acronym=="HI"|State_Acronym=="KS"|State_Acronym=="NM"|State_Acronym=="OK"|State_Acronym=="AL"|State_Acronym=="MT")
#Create Log Revenue
Rev2 <- Rev2 %>%
mutate(Log_CORPINCTX=log(CORPINCTX))
View(Rev2)
#Filter Rev 2 to just be NE with Control Group States
NE_DiD <- Rev2 %>%
filter(State_Acronym=="NE"|State_Acronym=="AK"| State_Acronym=="HI"|State_Acronym=="KS"|State_Acronym=="NM"|State_Acronym=="OK"|State_Acronym=="AL"|State_Acronym=="MT")
View(NE_DiD)
Rev2['treatment'] <- 0
Rev2[which(Rev2$state=="Nebraska" & Rev2$year>1988),"treatment"]<-1
View(Rev2)
fit_tw <- lm(CORPINCTX ~ treatment + factor(state) + factor(year),
data = Rev2)
summary(fit_tw)
#Create Treatment Column for NE
Rev2['treatment'] <- 0
Rev2[which(Rev2$state=="Nebraska" & Rev2$year>1988),"treatment"]<-1
fit_tw <- lm(CORPINCTX ~ treatment + factor(state) + factor(year),
data = Rev2)
summary(fit_tw)
fit_tw_Log <- lm(Log_CORPINCTX ~ treatment + factor(state) + factor(year),
data = Rev2)
summary(fit_tw_Log)
#Create Treatment Column for NE
NE_DiD['treatment'] <- 0
NE_DiD[which(NE_DiD$state=="Nebraska" & NE_DiD$year>1988),"treatment"]<-1
fit_tw <- lm(CORPINCTX ~ treatment + factor(state) + factor(year),
data = NE_DiD)
summary(fit_tw)
#Fit TW FE Log
fit_tw_Log <- lm(Log_CORPINCTX ~ treatment + factor(state) + factor(year),
data = NE_DiD)
summary(fit_tw_Log)
library(fixest)
install.packages("fixest")
install.packages("fixest")
library(fixest)
fit_tw_Log <- lm(Log_CORPINCTX ~
treatment |
state + year,
data = NE_DiD)
fit_tw_Log <- lm(Log_CORPINCTX ~
treatment |
factor(state) + year,
data = NE_DiD)
fit_tw_Log <- feols(Log_CORPINCTX ~
treatment |
state + year,
data = NE_DiD)
summary(fit_tw_Log)
#Plot
NE_Plot <- coefplot(fit_tw_Log)
#Create a time to Treat variable to Create Event Study Plot:
NE_DiD[, time_to_treat := ifelse(treatment==1, year - `_nfd`, 0)]
#Load Data Tables in R
install.packages("data.table")
library(data.table)
#Create a time to Treat variable to Create Event Study Plot:
NE_DiD[, time_to_treat := ifelse(treatment==1, year - `_nfd`, 0)]
View(NE_DiD)
#Create a time to Treat variable to Create Event Study Plot:
NE_DiD[, time_to_treat := ifelse(treatment==1, year - `_nfd`, 0)]
## Assuming NE_DiD is a data.frame
NE_DiD <- as.data.table(NE_DiD)
# Now you can use := for assignment
NE_DiD[, time_to_treat := ifelse(treatment == 1, year - `_nfd`, 0)]
# Now you can use := for assignment
NE_DiD[, time_to_treat := ifelse(treatment == 1, year - `1988`, 0)]
# Now you can use := for assignment
NE_DiD[, time_to_treat := ifelse(treatment == 1, year - 1988, 0)]
View(NE_DiD)
Rev3 <- Rev2 %>%
filter(c(year >=1976 & year <=2007))
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
Rev3 <- Rev2 %>%
filter(c(year >=1976 & year <=2007))
Rev3 <- Rev3 %>%
mutate(Log_CORPINCTX=log(CORPINCTX))
#Filter Rev 2 to just be NE with Control Group States
NE_DiD2 <- Rev3 %>%
filter(State_Acronym=="NE"|State_Acronym=="AK"| State_Acronym=="HI"|State_Acronym=="KS"|State_Acronym=="NM"|State_Acronym=="OK"|State_Acronym=="AL"|State_Acronym=="MT")
#Create Treatment Column for NE
NE_DiD2['treatment'] <- 0
NE_DiD2[which(NE_DiD2$state=="Nebraska" & NE_DiD2$year>1988),"treatment"]<-1
#Fit TW FE Log, but better
fit_tw_Log <- feols(Log_CORPINCTX ~
treatment |
state + year,
data = NE_DiD2)
summary(fit_tw_Log)
#Event Study Plot
NE_Plot2 <- coefplot(fit_tw_Log)
