View(AYC2)
View(AYC)
AllYears_SalesChange <- ALLYears_AppRev2 %>%
filter(perc_change_Sales != 0 | lag(perc_change_Sales) != 0 | lead(perc_change_Sales) != 0 | lead(perc_change_Sales, 2) != 0) %>%
slice(c(which(perc_change_Sales != 0 | lag(perc_change_Sales) != 0 | lead(perc_change_Sales) != 0 | lead(perc_change_Sales, 2) != 0) - 1,
which(perc_change_Sales != 0 | lag(perc_change_Sales) != 0 | lead(perc_change_Sales) != 0 | lead(perc_change_Sales, 2) != 0),
which(perc_change_Sales != 0 | lag(perc_change_Sales) != 0 | lead(perc_change_Sales) != 0 | lead(perc_change_Sales, 2) != 0) + 1,
which(perc_change_Sales != 0 | lag(perc_change_Sales) != 0 | lead(perc_change_Sales) != 0 | lead(perc_change_Sales, 2) != 0) + 2))
#Clean up the AllYears_SalesChange, there are duplicates
#Remove Duplicate Columns
AllYears_SalesChange_NoDup <- AllYears_SalesChange %>%
distinct(state, year, BUSLICTAX, .keep_all = T)
View(AllYears_SalesChange_NoDup)
View(AllYears_SalesChange_NoDup)
#Find the Percentage in Revenue for CORPORATE INCOME
RevPercChange_App<- AllYears_SalesChange_NoDup %>%
group_by(state)%>%
arrange(state,year)%>%
mutate(perc_change_CIT_Rev = ((CORPINCTX-lag(CORPINCTX))/((CORPINCTX+lag(CORPINCTX))/2)))
View(RevPercChange_App)
write.csv(RevPercChange_App,"SurroundingYears_PercChangeApp_Rev.csv")
PerChange <- RevPercChange_App %>%
group_by(state, year) %>%
filter(sales != 0) %>%
ungroup()
View(PerChange)
PerChange <- RevPercChange_App %>%
group_by(state, year) %>%
filter(perc_change_Sales != 0) %>%
ungroup()
View(PerChange)
OwnPartial_CIT <- PerChange %>%
arrange(state,year)%>%
mutate(OwnPartial_Elasticity= perc_change_CIT_Rev/perc_change_Sales)
View(OwnPartial_CIT)
OwnPrice_CIT <- PerChange %>%
arrange(state,year)%>%
mutate(OwnPartial_Elasticity= perc_change_CIT_Rev/perc_change_Sales)
View(OwnPrice_CIT)
#Create an Average for Each state
Avg_Elasticity_State <- OwnPrice_CIT %>%
group_by(state) %>%
mutate(Avg_Elasticity = mean(OwnPartial_Elasticity))
View(Avg_Elasticity_State)
filtered_RevPercChange_App <- RevPercChange_App %>%
distinct(state, .keep_all = TRUE)
# have 37 Elasticities to plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = state, y = Avg_Elasticity)) +
geom_bar(stat = "identity", fill = "steelblue") +
labs(title = "Average Elasticity by State",
x = "State",
y = "Average Elasticity") +
theme_minimal()
# Display the plot
print(plot)
View(filtered_RevPercChange_App)
#Just keep Average Own Price for each state:
filtered_RevPercChange_App <- Avg_Elasticity_State %>%
distinct(state, .keep_all = TRUE)
# have 37 Elasticities to plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = state, y = Avg_Elasticity)) +
geom_bar(stat = "identity", fill = "steelblue") +
labs(title = "Average Elasticity by State",
x = "State",
y = "Average Elasticity") +
theme_minimal()
# Display the plot
print(plot)
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none")
# Display the plot
print(plot)
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none")
# Display the plot
print(plot)
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(-3, 3))  # Adjust x-axis limits
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Determine the limits for the x-axis
x_min <- min(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
x_max <- max(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(floor(x_min) - 1, ceiling(x_max) + 1))  # Adjust x-axis limits
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Determine the limits for the x-axis
x_min <- min(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
x_max <- max(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(floor(x_min) - 1, ceiling(x_max) + 1))  # Adjust x-axis limits
# Display the plot
print(plot)
View(Avg_Elasticity_State)
View(filtered_RevPercChange_App)
OwnPrice_CIT <- OwnPrice_CIT %>%
filter(!is.na(OwnPartial_Elasticity))
Avg_Elasticity_State <- OwnPrice_CIT %>%
group_by(state) %>%
mutate(Avg_Elasticity = mean(OwnPartial_Elasticity))
filtered_RevPercChange_App <- Avg_Elasticity_State %>%
distinct(state, .keep_all = TRUE)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Determine the limits for the x-axis
x_min <- min(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
x_max <- max(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(floor(x_min) - 1, ceiling(x_max) + 1))  # Adjust x-axis limits
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Determine the limits for the x-axis
x_min <- min(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
x_max <- max(filtered_RevPercChange_App$Avg_Elasticity, na.rm = TRUE)
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = 0)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = -2, y = 0), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = 0, x = 2, y = 0), linetype = "dashed") +
geom_text(aes(label = State_Acronym, y = 0.05), vjust = 0, size = 4) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Display the plot
print(plot)
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = -2, y = State_Acronym), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = 2, y = State_Acronym), linetype = "dashed") +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none") +
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Display the plot
print(plot)
View(Merge)
View(Rev)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = -2, y = State_Acronym), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = 2, y = State_Acronym), linetype = "dashed") +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines every 0.2 along the x-axis
for (i in seq(-2, 2, by = 0.2)) {
plot <- plot + geom_segment(aes(x = i, xend = i, y = 0, yend = max(filtered_RevPercChange_App$State_Acronym) + 1), linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = -2, y = State_Acronym), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = State_Acronym, x = 2, y = State_Acronym), linetype = "dashed") +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines every 0.2 along the x-axis
for (i in seq(-2, 2, by = 0.2)) {
plot <- plot + geom_segment(aes(x = i, xend = i, y = min(filtered_RevPercChange_App$State_Acronym) - 1, yend = max(filtered_RevPercChange_App$State_Acronym) + 1), linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = as.numeric(State_Acronym), x = -2, y = as.numeric(State_Acronym)), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = as.numeric(State_Acronym), x = 2, y = as.numeric(State_Acronym)), linetype = "dashed") +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines every 0.2 along the x-axis
for (i in seq(-2, 2, by = 0.2)) {
plot <- plot + geom_segment(aes(x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App)), linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_segment(aes(xend = Avg_Elasticity, yend = as.numeric(State_Acronym), x = -2, y = as.numeric(State_Acronym)), linetype = "dashed") +
geom_segment(aes(xend = Avg_Elasticity, yend = as.numeric(State_Acronym), x = 2, y = as.numeric(State_Acronym)), linetype = "dashed") +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values
x_values <- c(0, 0.25, -0.25, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + geom_segment(aes(x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App)), linetype = "dashed")
}
# Display the plot
print(plot)
warnings()
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values using annotate()
x_values <- c(0, 0.25, -0.25, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + annotate("segment", x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App) + 1, linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Elasticity by State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values using annotate()
x_values <- c(0, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + annotate("segment", x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App) + 1, linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Own CIT Base Elasticity w.r.t Sales Apportionment Factor for each State",
x = "Avg_Elasticity",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values using annotate()
x_values <- c(0, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + annotate("segment", x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App) + 1, linetype = "dashed")
}
# Display the plot
print(plot)
# Set plot size
options(repr.plot.width = 10, repr.plot.height = 5)  # Adjust width and height as needed
# Create the scatter plot
plot <- ggplot(filtered_RevPercChange_App, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Own CIT Base Elasticity w.r.t Sales Apportionment Factor for each State",
x = "Avg Own CIT Elasticity w.r.t Apportionment Weight",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values using annotate()
x_values <- c(0, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + annotate("segment", x = i, xend = i, y = 1, yend = nrow(filtered_RevPercChange_App) + 1, linetype = "dashed")
}
# Display the plot
print(plot)
#Add Regions et al to merge on
RegionNumber <- read.xlsx("RNChart.xlsx")
#Add Regions et al to merge on
RegionNumber <- read_xlsx("RNChart.xlsx")
StateNumber <- read_xlsx("RegionNumber.xlsx")
View(RegionNumber)
View(StateNumber)
filtered_RevPercChange_App2 <- merge(filtered_RevPercChange_App,StateNumber,b=c("state"))
filtered_RevPercChange_App2 <- merge(filtered_RevPercChange_App,StateNumber,by=c("state"))
filtered_RevPercChange_App2 <- merge(filtered_RevPercChange_App2,RegionNumber,by=c("Number"))
View(filtered_RevPercChange_App2)
#filter out State, sales.x and Number
filtered_RevPercChange_App<-filtered_RevPercChange_App %>%
select(-Region,-Number)
filtered_RevPercChange_App2 <- merge(filtered_RevPercChange_App,StateNumber,by=c("state"))
filtered_RevPercChange_App2 <- merge(filtered_RevPercChange_App2,RegionNumber,by=c("Number"))
View(filtered_RevPercChange_App2)
View(filtered_RevPercChange_App2)
View(Rev)
# Specify columns to merge on
merge_cols <- c("group", "type", "year_pass_intro", "year_effective")
# Perform left join
merged_data <- merge(x = filtered_RevPercChange_App2,
y = Rev[, merge_cols, drop = FALSE],  # Select only specified columns from Rev
by = merge_cols,
all.x = TRUE)  # Perform left join
merged_data <- merge(x = filtered_RevPercChange_App2,
y = Rev[, merge_cols, drop = FALSE],  # Select only specified columns from Rev
by.x = "State_Acronym",  # Column in filtered_RevPercChange_App2
by.y = "State_Acronym",  # Column in Rev
all.x = TRUE)  # Perform left join
merged_data <- left_join(filtered_RevPercChange_App2,
Rev[, merge_cols, drop = FALSE],  # Select only specified columns from Rev
by = "State_Acronym") %>%
distinct(State_Acronym, .keep_all = TRUE)
merged_data <- left_join(filtered_RevPercChange_App2,
Rev[, merge_cols, drop = FALSE],  # Select only specified columns from Rev
by = "State_Acronym") %>%
distinct(State_Acronym, .keep_all = TRUE)
merged_data <- left_join(filtered_RevPercChange_App2,
Rev %>% select(State_Acronym, all_of(merge_cols)),
by = "State_Acronym")
View(merged_data)
merged_data <- right_join(filtered_RevPercChange_App2,
Rev %>% select(State_Acronym, all_of(merge_cols)),
by = "State_Acronym") %>%
distinct(State_Acronym, .keep_all = TRUE)
View(merged_data)
write.csv(merged_data,"Avg_CIT_Elasticity_With_Regions.csv")
# Create the scatter plot with merged_data
plot <- ggplot(merged_data, aes(x = Avg_Elasticity, y = State_Acronym)) +
geom_point(aes(color = State_Acronym), size = 3) +
geom_text(aes(label = State_Acronym), vjust = 0, size = 4, position = position_dodge(width = 0.2)) +
labs(title = "Average Own CIT Base Elasticity w.r.t Sales Apportionment Factor for each State",
x = "Avg Own CIT Elasticity w.r.t Apportionment Weight",
y = "") +
theme_minimal() +
theme(axis.title.y = element_blank(),
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
legend.position = "none",
plot.title = element_text(hjust = 0.5, margin = margin(b = 20))) +  # Center title and increase space
coord_cartesian(xlim = c(-2.5, 2.5))  # Adjust x-axis limits
# Add dashed vertical lines at specified x-values using annotate()
x_values <- c(0, 0.5, -0.5, 1, -1)
for (i in x_values) {
plot <- plot + annotate("segment", x = i, xend = i, y = 1, yend = nrow(merged_data) + 1, linetype = "dashed")
}
# Display the plot
print(plot)
View(merged_data)
# Check for missing values in "State_Acronym" after the join
missing_state_acronym <- merged_data %>%
filter(is.na(State_Acronym))
# View the rows with missing "State_Acronym"
print(missing_state_acronym)
View(filtered_RevPercChange_App2)
merged_data <- left_join(filtered_RevPercChange_App2,
Rev %>% select(State_Acronym, all_of(merge_cols)),
by = "State_Acronym") %>%
mutate(across(all_of(merge_cols),
~ ifelse(is.na(.), filtered_RevPercChange_App2[[cur_column()]], .)))
# Perform left join
merged_data <- left_join(filtered_RevPercChange_App2,
Rev %>% select(State_Acronym, all_of(merge_cols)),
by = "State_Acronym") %>%
rowwise() %>%
mutate(across(all_of(merge_cols),
~ if_else(is.na(.x), filtered_RevPercChange_App2[[cur_column()]], .x),
.names = "filled_{.col}")) %>%
select(-starts_with("filled_"))
