#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Attempt to Get all the Revenue in One Excel File
library(readxl)
#Attempt to Get all the Revenue in One Excel File
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
#set working directory
setwd("~/Documents/GitHub/Clean/SALT_FRED_Files_Excel")
#Read in Many DFs
#Create Vector of State Acronyms:
state_acronyms <- c("AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DE", "FL", "GA",
"HI", "IA", "ID", "IL", "IN", "KS", "KY", "LA", "MA", "MD",
"ME", "MI", "MN", "MO", "MS", "MT", "NC", "ND", "NE", "NH",
"NJ", "NM", "NV", "NY", "OH", "OK", "OR", "PA", "RI", "SC",
"SD", "TN", "TX", "UT", "VA", "VT", "WA", "WI", "WV", "WY")
# loop through the state acronyms and read in the corresponding Excel file
state_dfs <- list()
# Creates a Dataframe that stores each of the Excel files as a Dataframe
for (state in state_acronyms) {
file_name <- paste(state, ".xls", sep="")
sheet_name <- "Annual"
state_dfs[[state]] <- read_excel(file_name, sheet=sheet_name)
}
#^Succesfully Read in the Excel Files.
# Access the Alaska dataframe by its acronym. This is an example, and it creates a DF with just Alaska
AK_df <- state_dfs[["AK"]]
# Merge data frames in state_dfs on "DATE"
merged_df <- bind_rows(state_dfs, .id = "State") %>%
arrange(DATE)
View(merged_df)
merged_df1 <- bind_rows(state_dfs) %>%
arrange(DATE)
View(merged_df1)
View(merged_df)
first_ten_columns <- names(merged_df)[1:10]
names(merged_df) <- substring(names(merged_df),3,)
View(merged_df)
merged_df2 <- merged_df %>%
rename("State"="ate",
"Date"="DA")
#Rename the ST and DA columns
merged_df2 <- merged_df %>%
rename("State"="ate",
"Date"="TE")
rlang::last_trace()
rlang::last_trace(drop = FALSE)
merged_df2 <- merged_df %>%
full_join(merged_df, by=intersect(colnames(merged_df)))%>%
rename("State"="ate",
"Date"="TE")
#Rename the ST and DA columns
merged_df2 <- merged_df %>%
full_join(merged_df, by=intersect(colnames(merged_df),colnames(merged_df)))%>%
rename("State"="ate",
"Date"="TE")
rlang::last_trace()
View(merged_df1)
cbind(merged_df[1], mycol=na.omit(unlist(merged_df[-1]))
View(merged_df)
cbind(merged_df, mycol=na.omit(unlist(merged_df))
View(merged_df)
merged_df_merged <- merged_df %>%
group_by(ID) %>%
summarise_all(~ifelse(all(is.na(.)), NA, first(na.omit(.))))
merged_df_merged <- merged_df %>%
group_by(BUSLICTAX,CORPINCTX,CORPLICTAX,INCTAX,PROPTAX,SLGRTAX,SVRNCTAX,TLINCTAX,TLSLTAX,TOTLTAX) %>%
summarise_all(~ifelse(all(is.na(.)), NA, first(na.omit(.))))
# Merge data frames in state_dfs on "DATE"
Fresh_df <- bind_rows(state_dfs) %>%
arrange(DATE)
View(Fresh_df)
# Merge data frames in state_dfs on "DATE"
Fresh_df <- bind_rows(state_dfs,.id="State") %>%
arrange(DATE)
#California Example for Number of Taxes
CA_df <- state_dfs[["CA"]]
View(CA_df)
Fresh_df <- Fresh_df %>%
rename("naState"="State",
"naDate"="DATE")
View(state_dfs)
Fresh_df2 <- Fresh_df %>%
substring(names(Fresh_df),3,) %>%
group_by(BUSLICTAX,CORPINCTX,CORPLICTAX,INCTAX,PROPTAX,SLGRTAX,SVRNCTAX,TLINCTAX,TLSLTAX,TOTLTAX) %>%
summarise_all(~ifelse(all(is.na(.)), NA, first(na.omit(.))))
cleaned_column_names <- substring(names(Fresh_df), 3)
# Assign the cleaned names to the dataframe
names(Fresh_df) <- cleaned_column_names
# Group by the cleaned column names and summarize to merge columns while handling NAs
Fresh_df2 <- Fresh_df %>%
group_by(across(everything())) %>%
summarise_all(~ ifelse(all(is.na(.)), NA, first(na.omit(.))))
View(Fresh_df)
Fresh_df2 <- Fresh_df %>%
group_by(across(everything())) %>%
summarise_all(~ ifelse(all(is.na(.)), NA, first(na.omit(.))))
state_dfs
cleaned_state_dfs <- substring(names(state_dfs),3)
cleaned_state_dfs
View(state_dfs)
# Merge data frames in state_dfs on "DATE"
Fresh_df1 <- bind_rows(state_dfs,.id="State") %>%
arrange(DATE)
View(Fresh_df1)
#Create Dataframe for Loop that will get all the code in Final Dataframe
final_df <- data.frame()
for (State in Fresh_df1) {filter(if_any(everything(), is.na)
,colSums(is.na(Fresh_df1))<nrow(Fresh_df1)
rbind(final_df))}
NA_df <- bind_rows(state_dfs,.id="State") %>%
arrange(DATE)
View(NA_df)
for (State in NA_df) {filter(if_any(everything(), is.na)
,colSums(is.na(NA_df))<nrow(NA_df)
rbind(final_df))}
for (st in c("AK","AL")){ #state_acronyms
NA_df[NA_df$State==st]
#filter(if_any(everything(), is.na) ,colSums(is.na(NA_df))<nrow(NA_df)
rbind(final_df))
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
NA_df[NA_df$State==st]
#filter(if_any(everything(), is.na) ,colSums(is.na(NA_df))<nrow(NA_df)
rbind(final_df)
}
for (st in c("AK","AL")){ #state_acronyms
NA_df[NA_df$State==st,]
#filter(if_any(everything(), is.na) ,colSums(is.na(NA_df))<nrow(NA_df)
rbind(final_df)
}
View(final_df)
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
#filter(if_any(everything(), is.na) ,colSums(is.na(NA_df))<nrow(NA_df)
rbind(final_df, iteration)
}
View(iteration)
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- drop_na(iteration)
#filter(if_any(everything(), is.na) ,colSums(is.na(NA_df))<nrow(NA_df)
#rbind(final_df, iteration)
}
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(NA_df))<nrow(NA_df)]
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
View(iteration)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
View(iteration)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
substring(names(iteration[,2:]),3,)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
substring(names(iteration[,2:-1]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
View(iteration)
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
substring(names(iteration[,2:ncol(iteration)]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
hold <- substring(names(iteration[,2:ncol(iteration)]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
hold <- substring(names(iteration[,3:ncol(iteration)]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
newnames <- c("State", "DATE") + substring(names(iteration[,3:ncol(iteration)]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
newnames <- ["State", "DATE"] + substring(names(iteration[,3:ncol(iteration)]),3,)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
newnames <- list("State", "DATE") + substring(names(iteration[,3:ncol(iteration)]),3,)
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
list("State", "DATE")
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
newnames <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
#filter(if_any(everything(), is.na) ,
#rbind(final_df, iteration)
}
View(iteration)
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
#filter(if_any(everything(), is.na) ,
final_df <- rbind(final_df, iteration)
}
#Create Dataframe for Loop that will get all the code in Final Dataframe
final_df <- data.frame(,colnames(NA_df))
counter <- 1
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
if (counter > 1){final_df <- iteration}
else {final_df <- rbind(final_df, iteration)}
}
if (counter > 1){final_df <- iteration}
View(final_df)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
counter <- 1
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
if (counter > 1){
final_df <- iteration
}
else {
final_df <- rbind(final_df, iteration)
}
}
View(iteration)
View(state_dfs)
# Creates a Dataframe that stores each of the State's in the Merged NA Dataframe
counter <- 1
for (st in c("AK","AL")){ #state_acronyms
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
if (counter > 1){
final_df <- iteration
}
else {
final_df <- dplyr::bind_rows(final_df, iteration)
}
}
View(final_df)
counter <- 1
for (st in state_acronyms){
iteration <- NA_df[NA_df$State==st,]
iteration <- iteration[,colSums(is.na(iteration))<nrow(iteration)]
colnames(iteration) <- c("State", "DATE", substring(names(iteration[,3:ncol(iteration)]),3,))
if (counter > 1){
final_df <- iteration
}
else {
final_df <- dplyr::bind_rows(final_df, iteration)
}
}
View(final_df)
View(final_df)
#Save For CSV
write.csv(final_df,file="FRED_SALT_Rev_Feb_2024.csv", row.names=FALSE)
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment/CrossPartial")
Rev <- read.csv("FRED_SALT_Rev_Feb_2024.csv")
View(Rev)
