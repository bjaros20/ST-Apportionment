#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
Rev <- read.csv("filled_data_jmp.csv")
Log_rev <- read.csv("filled_log_data_jmp.csv")
View(Log_rev)
View(Rev)
View(Log_rev)
Rev <-Rev %>%
select(-X)
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
#remove the X column, must be something that happens when saving CSV
Rev <-Rev %>%
select(-X)
Log_rev <- Log_rev %>%
select(-X)
View(Log_rev)
library(readxl) #load ssfa switch date
Date <- read_xlsx("ssfa_data_jmp.xlsx")
View(Date)
Date <- read_xlsx("ssfa_data_jmp.xlsx")
View(Date)
View(Date)
Merge <- semi_join(Log_rev,Date, by="state")
View(Merge)
Date2 <- Date %>%
select(state,year_effective)
View(Date2)
#Merge those dates with Log_rev
Merge <- full_join(Log_rev,Date, by="state")
#Merge those dates with Log_rev
Merge <- full_join(Log_rev,Date2, by="state")
View(Merge)
# Create a Post Column
merged_df2 <- Merge %>%
group_by(state) %>%
mutate(Post = ifelse(year_effective > year, 0, 1)) %>%
ungroup()
#Create a treatment column from the Post Column and the group column
merged_df3 <- merged_df2 %>%
mutate(treatment = ifelse(Post == 1 & group == "t", 1, 0))
View(merged_df2)
View(Date)
#Now what approach?
#Going for Did
#reduce size of date dataframe:
Date2 <- Date %>%
select(state,year_effective,group)
#Merge those dates with Log_rev
Merge <- full_join(Log_rev,Date2, by="state")
# Create a Post Column
merged_df2 <- Merge %>%
group_by(state) %>%
mutate(Post = ifelse(year_effective > year, 0, 1)) %>%
ungroup()
merged_df3 <- merged_df2 %>%
mutate(treatment = ifelse(Post == 1 & group == "t", 1, 0))
#Create a Relative Year column for the Event Study Plot
# Create rel_year column
merged_df3$rel_year <- merged_df3$year - merged_df3$year_effective
View(merged_df3)
#Need the result with Total Tax
Res <- merged_df3 %>%
mutate(log_totrev=log(TOTLTAX))
View(Res)
#estimate a result for Total Taxes
treat_var <- "year_effective"
time_var <- "year"
str(Res)
#Make state a numeric factor
Res$state <- as.numeric(factor(Res$state))
#Run Callaway and Sant Anna
Res_attgt <- att_gt(yname = "log_totrev",
tname = "year",
idname = "state",
gname = "year_effective",
data = Res)
library(did) # for running DiD
library(caret)
#Run Callaway and Sant Anna
Res_attgt <- att_gt(yname = "log_totrev",
tname = "year",
idname = "state",
gname = "year_effective",
data = Res)
library(plm) # for Two way FE
library(fixest) # multiple FE
library(feols)
log_tot_ols = feols(log_totrev ~ log(Post) | state + year + rates, Res)
log_tot_ols = feols(log_totrev ~ log(Post) |factor(year), Res)
log_tot_ols = feols(log_totrev ~ log(Post), Res)
View(log_tot_ols)
summary(log_tot_ols, vcov = "twoway")
summary(log_tot_ols)
#plm FE model
zz1 <- plm(log_totrev ~ factor(Post))
#plm FE model
zz1 <- plm(log_totrev ~ factor(Post),Res)
#Replace other NA's in post to be Zero
Res2 <- Res[c("Post")][is.na(x[c("Post")])] <-0
#Replace other NA's in post to be Zero
Res2 <- Res[c("Post")][is.na(Res[c("Post")])] <-0
#Replace other NA's in post to be Zero
Res[c("Post")][is.na(Res[c("Post")])] <-0
#plm FE model
zz1 <- plm(log_totrev ~ factor(Post),Res)
str(Res)
Reg <- lm(log_totrev ~ Post + year + factor(state))
Reg <- lm(log_totrev ~ Post + year + factor(state),Res)
View(Reg)
Reg <- lm(log_totrev ~ Post + year + state,Res)
View(Reg)
summary(Reg)
#Simple reg with rate
Reg_rate <- lm(log_totrev ~ Post + year + state + rates, Res)
summary(Reg_rate)
#simple reg, with log rate
reg_lrate <-lm(log_totrev ~ Post + year + state + log(rates), Res)
#Simple reg with rate
factor_rate <- lm(log_totrev ~ Post + factor(year) + factor(state) + rates, Res)
summary(factor_rate)
#try sales as numeric variable
sales_reg <- lm(log_totrev ~ sales + factor (year)+ factor(state) + rates, Res)
summary(sales_reg)
log_sales_reg <- lm(log_totrev ~ log(sales) + factor (year)+ factor(state) + rates, Res)
summary(log_sales_reg)
#For comparison, will try with log sales
log_sales_reg <- lm(log_totrev ~ log(sales) + factor (year)+ factor(state) + log(rates), Res)
summary(log_sales_reg)
#For comparison, will try with log sales
log_sales_reg <- lm(log_totrev ~ log(sales) + factor (year)+ factor(state) + log(rates), Res)
