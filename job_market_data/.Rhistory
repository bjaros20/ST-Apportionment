unique()
# Filter out those states from the dataframe
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD using synthdid
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
se <- sqrt(vcov(current_tau_hat, method = 'placebo'))
# can increase replications by doing the following: se <- sqrt(vcov(current_tau_hat, method = 'placebo', replications=500))
#default is 200.
# Calculate the t-statistic, null hypothesis is zero
t_statistic <- (as.numeric(current_tau_hat)-0) / se
# Calculate the p-value
p_value_two_tail <- 2 * pt(-abs(t_statistic), df = nrow(current_df) - 1)
p_value_left_tail <-pt(t_statistic, df = nrow(current_df) - 1)
p_value_right_tail <-pt(t_statistic, df = nrow(current_df) - 1, lower.tail = FALSE)
# Print the point estimate, confidence interval, t-statistic, and p-value
cat(sprintf('State: %s\n', state_name))
cat(sprintf('Point estimate: %1.2f\n', current_tau_hat))
cat(sprintf('95%% CI (%1.2f, %1.2f)\n', current_tau_hat - 1.96 * se, current_tau_hat + 1.96 * se))
cat(sprintf('t-statistic: %1.3f\n', t_statistic))
cat(sprintf('p-value: %1.4f\n', p_value_two_tail))
cat(sprintf('p-value-"left-tail": %1.4f\n', p_value_left_tail))
cat(sprintf('p-value-"right-tail": %1.4f\n', p_value_right_tail))
# Summary statistics
#  print(summary(current_tau_hat))
}
View(current_df)
View(Arkansas)
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post","year_effective")])
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
current_df <- result_list[[state_name]]
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
# Access the dataframe
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post","year_effective")])
current_df <- as.data.frame(current_df)
# Access the dataframe
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
Year <- current_df$year_effective
current_year <- current_df$year_effective[1]
str(current_yaer)
str(current_year)
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
# Initialize an empty list to store point estimates and statistics
point_estimate_list <- list()
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Access the dataframe
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
current_year <- current_df$year_effective[1]
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
#eliminate Inf lines and the state that has them for estimation, like Ohio 2009-2013
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
# Filter out those states from the dataframe
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD using synthdid
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
se <- sqrt(vcov(current_tau_hat, method = 'placebo'))
# can increase replications by doing the following: se <- sqrt(vcov(current_tau_hat, method = 'placebo', replications=500))
#default is 200.
# Calculate the t-statistic, null hypothesis is zero
t_statistic <- (as.numeric(current_tau_hat)-0) / se
# Calculate the p-value
p_value_two_tail <- 2 * pt(-abs(t_statistic), df = nrow(current_df) - 1)
p_value_left_tail <-pt(t_statistic, df = nrow(current_df) - 1)
p_value_right_tail <-pt(t_statistic, df = nrow(current_df) - 1, lower.tail = FALSE)
# Print the point estimate, confidence interval, t-statistic, and p-value
cat(sprintf('State: %s\n', state_name))
cat(sprintf('Effective Year', current_year))
cat(sprintf('Point estimate: %1.2f\n', current_tau_hat))
cat(sprintf('95%% CI (%1.2f, %1.2f)\n', current_tau_hat - 1.96 * se, current_tau_hat + 1.96 * se))
cat(sprintf('t-statistic: %1.3f\n', t_statistic))
cat(sprintf('p-value: %1.4f\n', p_value_two_tail))
cat(sprintf('p-value-"left-tail": %1.4f\n', p_value_left_tail))
cat(sprintf('p-value-"right-tail": %1.4f\n', p_value_right_tail))
# Summary statistics
#  print(summary(current_tau_hat))
}
# Initialize an empty list to store point estimates and statistics
point_estimate_list <- list()
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Access the dataframe
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
current_year <- current_df$year_effective[1]
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
#eliminate Inf lines and the state that has them for estimation, like Ohio 2009-2013
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
# Filter out those states from the dataframe
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD using synthdid
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
se <- sqrt(vcov(current_tau_hat, method = 'placebo'))
# can increase replications by doing the following: se <- sqrt(vcov(current_tau_hat, method = 'placebo', replications=500))
#default is 200.
# Calculate the t-statistic, null hypothesis is zero
t_statistic <- (as.numeric(current_tau_hat)-0) / se
# Calculate the p-value
p_value_two_tail <- 2 * pt(-abs(t_statistic), df = nrow(current_df) - 1)
p_value_left_tail <-pt(t_statistic, df = nrow(current_df) - 1)
p_value_right_tail <-pt(t_statistic, df = nrow(current_df) - 1, lower.tail = FALSE)
# Print the point estimate, confidence interval, t-statistic, and p-value
cat(sprintf('State: %s\n', state_name))
cat(sprintf('Effective Year %d\n', current_year))
cat(sprintf('Point estimate: %1.2f\n', current_tau_hat))
cat(sprintf('95%% CI (%1.2f, %1.2f)\n', current_tau_hat - 1.96 * se, current_tau_hat + 1.96 * se))
cat(sprintf('t-statistic: %1.3f\n', t_statistic))
cat(sprintf('p-value: %1.4f\n', p_value_two_tail))
cat(sprintf('p-value-"left-tail": %1.4f\n', p_value_left_tail))
cat(sprintf('p-value-"right-tail": %1.4f\n', p_value_right_tail))
# Summary statistics
#  print(summary(current_tau_hat))
}
# Initialize an empty list to store point estimates and statistics
point_estimate_list <- list()
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Access the dataframe
current_df <- result_list[[state_name]]
#Make the tibble from the result list a dataframe, easier for panel.matrics function
current_df <- as.data.frame(current_df)
current_year <- current_df$year_effective[1]
#Drop states that have NA for ratio (like Alaska because no Income Tax)
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
#eliminate Inf lines and the state that has them for estimation, like Ohio 2009-2013
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
# Filter out those states from the dataframe
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD using synthdid
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
se <- sqrt(vcov(current_tau_hat, method = 'placebo'))
# can increase replications by doing the following: se <- sqrt(vcov(current_tau_hat, method = 'placebo', replications=500))
#default is 200.
# Calculate the t-statistic, null hypothesis is zero
t_statistic <- (as.numeric(current_tau_hat)-0) / se
# Calculate the p-value
p_value_two_tail <- 2 * pt(-abs(t_statistic), df = nrow(current_df) - 1)
p_value_left_tail <-pt(t_statistic, df = nrow(current_df) - 1)
p_value_right_tail <-pt(t_statistic, df = nrow(current_df) - 1, lower.tail = FALSE)
# Print the point estimate, confidence interval, t-statistic, and p-value
cat(sprintf('State: %s\n', state_name))
cat(sprintf('Effective Year: %d\n', current_year))
cat(sprintf('Point estimate: %1.2f\n', current_tau_hat))
cat(sprintf('95%% CI (%1.2f, %1.2f)\n', current_tau_hat - 1.96 * se, current_tau_hat + 1.96 * se))
cat(sprintf('t-statistic: %1.3f\n', t_statistic))
cat(sprintf('p-value: %1.4f\n', p_value_two_tail))
cat(sprintf('p-value-"left-tail": %1.4f\n', p_value_left_tail))
cat(sprintf('p-value-"right-tail": %1.4f\n', p_value_right_tail))
# Summary statistics
#  print(summary(current_tau_hat))
}
summary_stats <- Filter_frac %>%
filter(!is.na(real_ci_cap) & is.finite(real_ci_cap)) %>%  # Remove rows with NA in nat_share
group_by(State_Name) %>%
summarize(
mean = mean(real_ci_cap, na.rm = TRUE),
median = median(real_ci_cap, na.rm = TRUE),
IQR = IQR(real_ci_cap, na.rm = TRUE),
min = min(real_ci_cap, na.rm = TRUE),
max = max(real_ci_cap, na.rm = TRUE)
)
print(summary_stats,n = nrow(summary_stats))
states_to_plot <- c("Illinois", "Indiana", "North Dakota", "Delaware")
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for nat_share_ci and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "nat_share_ci", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(nat_share_ci))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "nat_share_ci", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
# Plot and save the sDiD estimate
plot <- plot(current_tau_hat) +
labs(x = "Year", y = "Share of Nationwide Corporate Income") +
ggtitle(paste("Synthetic Difference in Difference -", state_name, "= treated")) +
theme_fivethirtyeight() +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.line = element_line(linewidth = 0.5, colour = "black")
)
# Print the plot
print(plot)
# Save each plot as an image
ggsave(filename = paste0(state_name, "_sDiD_plot_CI_share.png"), plot = plot)
}
}
#
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for real_ci_cap and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
# Plot and save the sDiD estimate
plot <- plot(current_tau_hat) +
labs(x = "Year", y = "Real, Naive Corporate Income per Capita") +
ggtitle(paste("Synthetic Difference in Difference -", state_name, "= treated")) +
theme_fivethirtyeight() +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.line = element_line(linewidth = 0.5, colour = "black")
)
# Print the plot
print(plot)
# Save each plot as an image
ggsave(filename = paste0(state_name, "_sDiD_plot_CI_share.png"), plot = plot)
}
}
#PART III - Plot significant states
# List of states to plot
states_to_plot <- c("Illinois", "Indiana", "North Dakota", "Delaware", "New York", "California")
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for real_ci_cap and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
# Plot and save the sDiD estimate
plot <- plot(current_tau_hat) +
labs(x = "Year", y = "Real, Naive Corporate Income per Capita") +
ggtitle(paste("Synthetic Difference in Difference -", state_name, "= treated")) +
theme_fivethirtyeight() +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.line = element_line(linewidth = 0.5, colour = "black")
)
# Print the plot
print(plot)
# Save each plot as an image
ggsave(filename = paste0(state_name, "_sDiD_plot_CI_share.png"), plot = plot)
}
}
states_to_plot <- c("Illinois", "Indiana", "North Dakota", "Delaware", "New York", "California", "Michigan", "Arizona")
# Loop over each dataframe in result_list
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for real_ci_cap and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
# Plot and save the sDiD estimate
plot <- plot(current_tau_hat) +
labs(x = "Year", y = "Real, Naive Corporate Income per Capita") +
ggtitle(paste("Synthetic Difference in Difference -", state_name, "= treated")) +
theme_fivethirtyeight() +
theme(
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
axis.line = element_line(linewidth = 0.5, colour = "black")
)
# Print the plot
print(plot)
# Save each plot as an image
ggsave(filename = paste0(state_name, "_sDiD_plot_CI_share.png"), plot = plot)
}
}
#Create a loop for Weights and Dates for plots
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for real_ci_cap and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
print(summary(current_tau_hat))
}
}
#Create a loop for Weights and Dates for plots
for (state_name in names(result_list)) {
# Only proceed if the state is in the states_to_plot list
if (state_name %in% states_to_plot) {
# Access the dataframe
current_df <- result_list[[state_name]]
# Convert tibble to dataframe
current_df <- as.data.frame(current_df)
# Drop rows with NA for real_ci_cap and filter out states with Inf values
current_df <- na.omit(current_df[, c("State_Acronym", "year", "real_ci_cap", "Post")])
states_with_inf <- current_df %>%
group_by(State_Acronym) %>%
filter(any(is.infinite(real_ci_cap))) %>%
pull(State_Acronym) %>%
unique()
current_df <- current_df %>%
filter(!State_Acronym %in% states_with_inf)
# Create the panel matrices for sDiD
current_sDiD <- panel.matrices(current_df, unit = "State_Acronym", time = "year", outcome = "real_ci_cap", treatment = "Post")
# Calculate the synthetic difference-in-differences estimate
current_tau_hat <- synthdid_estimate(current_sDiD$Y, current_sDiD$N0, current_sDiD$T0)
#Print State Name and Summary for plots
cat(sprintf('State: %s\n', state_name))
print(summary(current_tau_hat))
}
}
# Main result: Naive, Real, Corporate Income per capita
#Empirical Approach, sDiD
# Care about the t-statistic, need to BOOTSTRAP with replace for normal distribution
#Run a one-sided Significance test
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
library(boot)
library(ggthemes)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
naive_ci<-read.csv("naive_ci.csv")
# Next thing to estimate, Real Corporate Income, base year 1983-1984
real_CI <- naive_ci%>%
mutate(real_ci = (naive_ci/CPI_def)*100)
View(real_CI)
#Make percentage change column for Naive, RealCORPORATE INCOME
per_chan_real_ci <- real_CI %>%
group_by(State_Acronym)%>%
arrange(State_Acronym,year)%>%
mutate(per_chan_rci= ((real_ci-lag(real_ci))/((real_ci+lag(real_ci))/2)))
View(per_chan_real_ci)
#Make percentage change column for Naive, RealCORPORATE INCOME
per_chan_real_ci <- real_CI %>%
group_by(State_Acronym)%>%
arrange(State_Acronym,year)%>%
mutate(per_chan_rci= ((real_ci-lag(real_ci))/((real_ci+lag(real_ci))/2)))%>%
ungroup()
View(per_chan_real_ci)
per_chan_real_ci <- real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(per_chan_rci = ifelse(lag(real_ci) > 0 & real_ci > 0,
(real_ci - lag(real_ci)) / ((real_ci + lag(real_ci)) / 2),
NA)) %>%
ungroup()
View(per_chan_real_ci)
View(per_chan_real_ci)
per_chan_real_ci <- real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(per_chan_rci = ifelse(lag(real_ci) > 0 & real_ci > 0,
(real_ci - lag(real_ci)) / ((real_ci + lag(real_ci)) / 2),
NA)) %>%
ungroup()
View(per_chan_real_ci)
#Make percentage change column for Naive, RealCORPORATE INCOME
per_chan_real_ci <- real_CI %>%
group_by(state)%>%
arrange(state,year)%>%
mutate(per_chan_rci = ((real_ci-lag(real_ci))/((real_ci+lag(real_ci))/2)))%>%
ungroup()
View(per_chan_real_ci)
library(dplyr)
per_chan_real_ci <- real_CI %>%
group_by(state)%>%
arrange(state,year)%>%
mutate(per_chan_rci = ((real_ci-lag(real_ci))/((real_ci+lag(real_ci))/2)))%>%
ungroup()
View(per_chan_real_ci)
real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(lag_real_ci = lag(real_ci)) %>%
select(State_Acronym, year, real_ci, lag_real_ci) %>%
head(20)
real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(lag_real_ci = lag(real_ci, order_by = year)) %>%
select(State_Acronym, year, real_ci, lag_real_ci) %>%
head(20)
real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(lag_real_ci = lag(real_ci, n = 1)) %>%
select(State_Acronym, year, real_ci, lag_real_ci) %>%
head(20)
per_chan_real_ci2 <- real_CI %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
mutate(per_change_real_ci = ((real_ci - lag(real_ci)) / lag(real_ci)) * 100) %>%
ungroup()
View(per_chan_real_ci2)
