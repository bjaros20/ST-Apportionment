#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Naive Corporate Income Calculation, stacked DiD, Agrawal feedback
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest) # for stacked DiD
library(boot)
library(ggthemes)
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
naive_ci<-read.csv("naive_ci.csv")
#create log real naive CI
real_log_nci <- naive_ci %>%
mutate(real_log_nci = log(real_ci))
stacked_df  <- read.csv("stacked__nci_DiD.csv")
# Create a unique identifier for each year and event_id combination
stacked_df <- stacked_df %>%
mutate(year_event_id = paste(year, event_id, sep = "_"))
#
library(plm)
# Convert data to pdata.frame
stacked_df2 <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym", "year"))
# Run model without interaction in plm
model_plm <- plm(
real_log_nci ~ treated + i(rel_year_did, ref = -1),  # No interaction term
data = stacked_df2,
model = "within",  # Fixed-effects model
effect = "twoways"  # Include both "event_id" and "year_event_id"
)
summary(model_plm)
#Plot for Stacked DiD
library(broom)
# Extract coefficients related to `rel_year_did`
tidy_model <- broom::tidy(model_plm)
# Filter only for the `rel_year_did` coefficients and add -1 as the reference year
plot_data <- tidy_model %>%
filter(grepl("rel_year_did", term)) %>%  # Keep only rel_year_did terms
mutate(
rel_year_did = as.numeric(gsub(".*\\)", "", term)),  # Extract year from term name
conf.low = estimate - 1.96 * std.error,  # Lower bound of 95% CI
conf.high = estimate + 1.96 * std.error   # Upper bound of 95% CI
)
# Check output
print(plot_data)
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Two-Way Fixed-Effects Plot of SSFA",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
scale_x_continuous(breaks = -4:4) +  # Ensure all event years from -4 to 4 appear on x-axis
theme_minimal()
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Two-Way Fixed-Effects Plot of SSFA",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
scale_x_continuous(breaks = -4:4) +  # Ensure all event years from -4 to 4 appear on x-axis
theme_stata()
