#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#redo TWFE Regressions- Section 6.2- Jonathan Feedback post Jan 17 workshop
# Examine TWFE four main outcomes:
# a. Corporate Tax Revenue
# b. Non-corporate tax revenue
# c. tax rates
# d. Proxy Corporate Income.
#load packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(ggthemes)
library(lmtest)
library(did) # for running DiD
library(plm)
library(lmtest)
library(fixest)
library(boot)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#load data
data <- read.csv("real_log_nci.csv")
View(data)
#use this as guide https://libguides.princeton.edu/R-Panel
fixed <-plm(logRealCitRev ~ Post, data = data, index=c("State_Acronym","year"), model = "within") #fixed effects
random <-plm(logRealCitRev ~ Post, data = data, index=c("State_Acronym","year"), model = "random")
phtest(fixed,random)
# Estimate Two-Way Fixed Effects Model
twfe_model <- plm(logRealCitRev ~ Post + factor(year),
data = data,
index = c("State_Acronym", "year"),
model = "within")  # Fixed effects model
# Summary of the model
summary(twfe_model)
#Coefficients:
#Estimate Std. Error t-value  Pr(>|t|)
#Post             -0.0238689  0.0281037 -0.8493 0.3958078
# Clustered SE at the state level
coeftest(twfe_model, vcov = vcovHC(twfe_model, type = "HC0", cluster = "group"))
# TWFE using fixest
twfe_fixest <- feols(logRealCitRev ~ Post | State_Acronym + year, data = data)
# Summary with robust SE
summary(twfe_fixest, cluster = "State_Acronym")
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest, cluster = "State_Acronym"))  # Clustered SEs
coef_df$Variable <- rownames(coef_df)
# Plot using ggplot2
ggplot(coef_df, aes(x = Variable, y = Estimate, ymin = Estimate - 1.96 * `Std. Error`, ymax = Estimate + 1.96 * `Std. Error`)) +
geom_pointrange() +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_minimal() +
labs(title = "Effect of Post on Log Corporate Income",
x = "Variable",
y = "Coefficient Estimate") +
coord_flip()
# Plot using ggplot2
ggplot(coef_df, aes(x = Variable, y = Estimate, ymin = Estimate - 1.96 * `Std. Error`, ymax = Estimate + 1.96 * `Std. Error`)) +
geom_pointrange() +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_minimal() +
labs(title = "Effect of Post on Log Corporate Income",
x = "Variable",
y = "Coefficient Estimate") +
coord_flip() + theme_fivethirtyeight()
#TWFE on NonCorporate Tax Revnue
twfe_fixest_RNCTR <- feols(log_RNCTR ~ Post | State_Acronym + year, data = data)
# Summary with robust SE
summary(twfe_fixest_RNCTR, cluster = "State_Acronym")
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest_RNCTR, cluster = "State_Acronym"))  # Clustered SEs
coef_df$Variable <- rownames(coef_df)
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest, cluster = "State_Acronym"))  # Clustered SEs
coef_df$Variable <- rownames(coef_df)
# Plot using ggplot2
ggplot(coef_df, aes(x = Variable, y = Estimate, ymin = Estimate - 1.96 * `Std. Error`, ymax = Estimate + 1.96 * `Std. Error`)) +
geom_pointrange() +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_minimal() +
labs(title = "Effect of Post on Log Corporate Tax Revenue",
x = "Variable",
y = "Coefficient Estimate") +
coord_flip() + theme_fivethirtyeight()
#TWFE on NonCorporate Tax Revnue
twfe_fixest_RNCTR <- feols(log_RNCTR ~ Post | State_Acronym + year, data = data)
# Summary with robust SE
summary(twfe_fixest_RNCTR, cluster = "State_Acronym")
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest_RNCTR, cluster = "State_Acronym"))  # Clustered SEs
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest_RNCTR, cluster = "State_Acronym"))  # Clustered SEs
coef_df$Variable <- rownames(coef_df)
# Plot using ggplot2
ggplot(coef_df, aes(x = Variable, y = Estimate, ymin = Estimate - 1.96 * `Std. Error`, ymax = Estimate + 1.96 * `Std. Error`)) +
geom_pointrange() +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_minimal() +
labs(title = "Effect of Post on Real Log Non Corporate Income",
x = "Variable",
y = "Coefficient Estimate") +
coord_flip() + theme_fivethirtyeight()
#TWFE on Proxy Corporate Income
twfe_fixest_CI <- feols(log_RNCTR ~ Post | State_Acronym + year, data = data)
# Summary with robust SE
summary(twfe_fixest_CI, cluster = "State_Acronym")
#TWFE on Proxy Corporate Income
twfe_fixest_CI <- feols(real_log_nci ~ Post | State_Acronym + year, data = data)
# Summary with robust SE
summary(twfe_fixest_CI, cluster = "State_Acronym")
# Extract coefficient estimate and standard error
coef_df <- as.data.frame(coeftable(twfe_fixest_CI, cluster = "State_Acronym"))  # Clustered SEs
coef_df$Variable <- rownames(coef_df)
# Plot using ggplot2
ggplot(coef_df, aes(x = Variable, y = Estimate, ymin = Estimate - 1.96 * `Std. Error`, ymax = Estimate + 1.96 * `Std. Error`)) +
geom_pointrange() +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_minimal() +
labs(title = "Effect of Post on Log Corporate Income",
x = "Variable",
y = "Coefficient Estimate") +
coord_flip() + theme_fivethirtyeight()
print(data$rel_year)
#Check for Event study style.
# Convert rel_year to factor
data$rel_year <- as.factor(data$rel_year)
event_study_model <- feols(real_log_nci ~ i(rel_year, ref = -1) * treated | State_Acronym + year,
data = data)
event_study_model <- feols(real_log_nci ~ i(rel_year, ref = -1) * Post | State_Acronym + year,
data = data)
# TWFE event study model using plm
event_study_plm <- plm(real_log_nci ~ i(rel_year, ref = -1),
data = data,
index = c("State_Acronym", "year"),
model = "within",
effect = "twoways")
# Summary
summary(event_study_plm)
# TWFE event study model using plm
event_study_plm <- plm(real_log_nci ~i(rel_year, ref = -1) + i(rel_year, ref = -1)*Post,
data = data,
index = c("State_Acronym", "year"),
model = "within",
effect = "twoways")
# Summary
summary(event_study_plm)
# TWFE event study model using plm
event_study_plm <- plm(real_log_nci ~i(rel_year, ref = -1)*Post,
data = data,
index = c("State_Acronym", "year"),
model = "within",
effect = "twoways")
# Summary
summary(event_study_plm)
