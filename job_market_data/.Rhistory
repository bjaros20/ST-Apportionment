#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
# set seed
set.seed(26)
#Load Revenue panel
Rev <- read.csv("logTotRev_cpi.csv")
View(Rev)
Rev <- Rev %>%
select(-X)
View(Rev)
library(sjlabelled) # req by https://rpubs.com/phle/r_tutorial_difference_in_differences
install.packages("sjlabelled")
library(sjlabelled) # req by https://rpubs.com/phle/r_tutorial_difference_in_differences
install.packages("ggrepel")
library(ggrepel) # req by ^
install.packages("scales")
install.packages("scales")
library(scales) # req by ^
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for ru
library(sjlabelled)
library(ggrepel) # req
library(scales)
install.packages("ggpubr")
install.packages("ggpubr")
library(ggpubr) # req by ^
library(plm)
library(lmtest)
#Create a dataframe with just 2007 states
treated_states <- Rev %>%
select(year_effective=2007)
#Create a dataframe with just 2007 states
treated_states <- Rev %>%
select(year_effective==2007)
#Create a dataframe with just 2007 states
treated_states <- Rev %>%
filter(year_effective==2007)
View(treated_states)
control_states <- Rev %>%
filter(year_effective >=2011 or NA)
control_states <- Rev %>%
filter(year_effective >=2011 | is.na(year_effective))
View(control_states)
str(control_states)
# find mean of control_States
control_pre <-control_states %>%
filter(treatment == 0, Post == 0) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm= TRUE))
control_post <-control_states %>%
filter(treatment == 0, Post == 1) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm= TRUE))
View(control_pre)
View(control_post)
View(control_pre)
View(control_post)
View(control_pre)
control_pre <-control_states %>%
filter(year <= 2007) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm= TRUE))
View(control_post)
View(control_pre)
control_post <-control_states %>%
filter(2010> year >2007) %>%
control_post <-control_states %>%
filter(year >2007 & year<2011) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm= TRUE))
# calculate averages for treatment group
treatment_pre <- treated_states %>%
filter(treatment == 1, Post == 0) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm = TRUE))
treatment_post <- treated_states %>%
filter(year >2007 & year<2011) %>%
summarise(avg_outcome = mean(logRealTotRev, na.rm = TRUE))
# Calculate differences
control_diff <- control_post$avg_outcome - control_pre$avg_outcome
treatment_diff <- treatment_post$avg_outcome - treatment_pre$avg_outcome
View(treatment_post)
View(treatment_pre)
treatment_pre <- treated_states %>%
filter(year <= 2007) %>%
summarize(avg_outcome = mean(logRealTotRev, na.rm = TRUE))
View(treatment_pre)
control_diff <- control_post$avg_outcome - control_pre$avg_outcome
treatment_diff <- treatment_post$avg_outcome - treatment_pre$avg_outcome
# Calculate Difference-in-Differences
did_estimate <- treatment_diff - control_diff
# Print the DiD estimate
did_estimate
# Calculate average Log Total Tax by year for control group along with standard error
average_c <- control_states %>%
group_by(year) %>%
summarise(average_TOTLTX_c = mean(logRealTotRev),
std_err_c = sd(logRealTotRev) / sqrt(n()))
View(average_c)
# Calculate average logRealTotRev by year for treated states along with standard error
average_t <- treated_states %>%
group_by(year) %>%
summarise(average_TOTLTX_t = mean(logRealTotRev),
std_err_t = sd(logRealTotRev) / sqrt(n()))
View(average_c)
# Calculate average Log Total Tax by year for control group along with standard error
average_c <- control_states %>%
group_by(year) %>%
filter(!is.na(logRealTotRev)) %>%
summarise(average_TOTLTX_c = mean(logRealTotRev),
std_err_c = sd(logRealTotRev) / sqrt(n()))
# Calculate average logRealTotRev by year for treated states along with standard error
average_t <- treated_states %>%
group_by(year) %>%
filter(!is.na(logRealTotRev)) %>%
summarise(average_TOTLTX_t = mean(logRealTotRev),
std_err_t = sd(logRealTotRev) / sqrt(n()))
# Merge the two dataframes by year
average_df <- merge(average_c, average_t, by = "year", all = TRUE)
# Create the plot
ggplot(average_df, aes(x = year)) +
geom_point(aes(y = average_CORPINCTX_c, color = "Control Group"), size = 3) +
geom_errorbar(aes(y = average_CORPINCTX_c, ymin = average_CORPINCTX_c - std_err_c, ymax = average_CORPINCTX_c + std_err_c, color = "Control Group"), width = 0.2) +
geom_point(aes(y = average_CORPINCTX_t, color = "Treatment Group"), size = 3) +
geom_errorbar(aes(y = average_CORPINCTX_t, ymin = average_CORPINCTX_t - std_err_t, ymax = average_CORPINCTX_t + std_err_t, color = "Treatment Group"), width = 0.2) +
labs(title = "Average Corporate Income Tax by Year for Control and Treatment Groups",
x = "Year",
y = "Average CORPINCTX") +
scale_color_manual(values = c("Control Group" = "blue", "Treatment Group" = "red"),
labels = c("Control Group" = "Group c", "Treatment Group" = "Group t")) +
guides(color = guide_legend(title = "Groups")) +
theme_minimal()
# Create the plot
ggplot(average_df, aes(x = year)) +
geom_point(aes(y = average_TOTLTX_c, color = "Control Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_c, ymin = average_TOTLTX_c - std_err_c, ymax = average_TOTLTX_c + std_err_c, color = "Control Group"), width = 0.2) +
geom_point(aes(y = average_TOTLTX_t, color = "Treatment Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_t, ymin = average_TOTLTX_t - std_err_t, ymax = average_TOTLTX_t + std_err_t, color = "Treatment Group"), width = 0.2) +
labs(title = "Average Log Real Total Tax Revenue by Year for Control and Treatment Groups",
x = "Year",
y = "Average Log Real Total Tax Revenue") +
scale_color_manual(values = c("Control Group" = "blue", "Treatment Group" = "red"),
labels = c("Control Group" = "Group c", "Treatment Group" = "Group t")) +
guides(color = guide_legend(title = "Groups")) +
theme_minimal()
ggplot(average_df, aes(x = year)) +
geom_point(aes(y = average_TOTLTX_c, color = "Control Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_c, ymin = average_TOTLTX_c - std_err_c, ymax = average_TOTLTX_c + std_err_c, color = "Control Group"), width = 0.2) +
geom_point(aes(y = average_TOTLTX_t, color = "Treatment Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_t, ymin = average_TOTLTX_t - std_err_t, ymax = average_TOTLTX_t + std_err_t, color = "Treatment Group"), width = 0.2) +
geom_vline(xintercept = 2007, linetype = "dashed", color = "black", size = 1) +
labs(title = "Average Log Real Total Tax Revenue by Year for Control and Treatment Groups",
x = "Year",
y = "Average Log Real Total Tax Revenue") +
scale_color_manual(values = c("Control Group" = "blue", "Treatment Group" = "red"),
labels = c("Control Group" = "Group c", "Treatment Group" = "Group t")) +
guides(color = guide_legend(title = "Groups")) +
theme_minimal()
ggplot(average_df, aes(x = year)) +
geom_point(aes(y = average_TOTLTX_c, color = "Control Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_c, ymin = average_TOTLTX_c - std_err_c, ymax = average_TOTLTX_c + std_err_c, color = "Control Group"), width = 0.2) +
geom_point(aes(y = average_TOTLTX_t, color = "Treatment Group"), size = 3) +
geom_errorbar(aes(y = average_TOTLTX_t, ymin = average_TOTLTX_t - std_err_t, ymax = average_TOTLTX_t + std_err_t, color = "Treatment Group"), width = 0.2) +
geom_vline(xintercept = 2007, linetype = "dashed", color = "black", size = 1) +
labs(title = "Average Log Real Total Tax Revenue by Year for Control and Treatment Groups",
x = "Year",
y = "Average Log Real Total Tax Revenue") +
scale_color_manual(values = c("Control Group" = "blue", "Treatment Group" = "red"),
labels = c("Control Group" = "Group c", "Treatment Group" = "Group t")) +
guides(color = guide_legend(title = "Groups")) +
xlim(2004, 2010) +
theme_minimal()
#Create dataframe with states in control_states
states_1df <- control_states %>%
distinct(State_Acronym)
print(states_1df)
View(control_states)
states_2df <- treated_states %>%
distinct(State_Acronym)
print(states_2df)
