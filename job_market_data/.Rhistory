mutate(treated = 1,  # Mark as treated
event_id = paste(state_of_interest, treatment_year, sep = "_"),
rel_year_did = rel_year)  # Unique event ID
# 2. Define the Clean Control Group
remaining_control <- filt_Corp %>%
filter(State_Acronym != state_of_interest) %>%  # Exclude treatment state
filter(is.na(year_effective) | year_effective > (treatment_year + 4)) %>%  # Exclude states with SSFA adoption within +4 years
# Additional Filters for Ohio
filter(!(State_Acronym == "OH" & year < 2008)) %>%  # Remove Ohio for all years prior to 2008, Oh always giving problems
filter(!(State_Acronym == "OH" & year_effective > 2004)) #
# Step (2): Keep only observations within the -4 to +4 year window relative to the treatment year
clean_control <- remaining_control %>%
filter(year >= (treatment_year - 4) & year <= (treatment_year + 4)) %>%
mutate(treated = 0,  # Mark as control
event_id = paste(state_of_interest, treatment_year, sep = "_"),
rel_year_did = year - treatment_year)  # Use same event ID
# Combine the treatment and control data for the current state’s event
event_data <- bind_rows(treatment_event, clean_control)
# Append the event data to the stacked dataframe
stacked_df <- bind_rows(stacked_df, event_data)
}
View(stacked_df)
# Run the model with rel_year_did
model <- feols(
log_ci ~ treated * i(rel_year_did, ref = -1) | event_id + year_event_id,
data = stacked_df,
cluster = ~State_Acronym
)
# Run the model with rel_year_did
model <- feols(
log_ci ~ treated * i(rel_year_did, ref = -1) | event_id + year * factor(event_id),
data = stacked_df,
cluster = ~State_Acronym
)
# Run the model with rel_year_did
model <- feols(
log_ci ~ treated * i(rel_year_did, ref = -1) | event_id + year * event_id,
data = stacked_df,
cluster = ~State_Acronym
)
# Create a unique identifier for each year and event_id combination
stacked_df <- stacked_df %>%
mutate(year_event_id = paste(year, event_id, sep = "_"))
# Run the model with rel_year_did and year_event_id
model <- feols(
log_ci ~ treated * i(rel_year_did, ref = -1) | event_id + year_event_id,
data = stacked_df,
cluster = ~State_Acronym
)
summary(model)
write.csv(stacked_df,"stacked_DiD.csv",row.names=FALSE)
View(stacked_df)
#
library(plm)
# Convert data to pdata.frame
stacked_df <- pdata.frame(stacked_df, index = c("State_Acronym", "year"))
# Convert data to pdata.frame
stacked_df <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym"))
View(df)
model_plm <- plm(
log_ci ~ treated + i(rel_year_did, ref = -1),  # No interaction term
data = stacked_df,
model = "within",  # Fixed-effects model
effect = "twoways"  # Include both "event_id" and "year_event_id"
)
summary(model_plm)
# Convert data to pdata.frame
stacked_df <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym"))
# Convert data to pdata.frame
stacked_df2 <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym"))
# Convert data to pdata.frame
stacked_df2 <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym", "year"))
# Check for duplicates in the combined index
table(index(stacked_df, c("event_id", "State_Acronym", "year")), useNA = "ifany")
# Check for duplicates in the combined index
duplicates <- stacked_df %>%
group_by(event_id, State_Acronym, year) %>%
filter(n() > 1)
# Print duplicates if any are found
if (nrow(duplicates) > 0) {
print("Duplicates found:")
print(duplicates)
} else {
print("No duplicates found.")
}
# Convert data to pdata.frame
stacked_df2 <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym", "year"))
stacked_df %>%
distinct(event_id, State_Acronym, year, .keep_all = TRUE)
model_plm <- plm(
log_ci ~ treated + i(rel_year_did, ref = -1),  # No interaction term
data = stacked_df,
model = "within",  # Fixed-effects model
effect = "twoways"  # Include both "event_id" and "year_event_id"
)
summary(model_plm)
#Plot for Stacked DiD
library(broom)
# Extract coefficients related to `rel_year_did`
tidy_model <- broom::tidy(model_plm)
# Filter only for the `rel_year_did` coefficients and add -1 as the reference year
plot_data <- tidy_model %>%
filter(grepl("rel_year_did", term)) %>%
mutate(
rel_year_did = as.numeric(gsub(".*::", "", term)),  # Extract year from term name
conf.low = estimate - 1.96 * std.error,  # Lower bound of 95% CI
conf.high = estimate + 1.96 * std.error   # Upper bound of 95% CI
)
View(tidy_model)
print(tidy_model)
# Filter only for the `rel_year_did` coefficients and add -1 as the reference year
plot_data <- tidy_model %>%
filter(grepl("rel_year_did", term)) %>%  # Keep only rel_year_did terms
mutate(
rel_year_did = as.numeric(gsub(".*\\)", "", term)),  # Extract year from term name
conf.low = estimate - 1.96 * std.error,  # Lower bound of 95% CI
conf.high = estimate + 1.96 * std.error   # Upper bound of 95% CI
)
# Check output
print(plot_data)
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of Treatment Effects by Relative Year",
x = "Relative Year",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_minimal()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of Treatment Effects by Relative Year",
x = "Relative Year",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_stata()
View(naive_ci)
#create log real naive CI
real_log_nci <- naive_ci %>%
mutate(real_log_nci = log(real_ci))
write.csv(real_log_nci,"real_log_nci.csv", row.names = FALSE)
#filter to necessary variables
filt_Corp <-real_log_nci %>%
select(State_Acronym,year,year_effective,State_Name,real_log_nci,Post, rel_year)
#start with one state, nebraska
# Define the state of interest
state_of_interest <- "Nebraska"
# Stacked DiD loop
# Initialize an empty dataframe to store the stacked event-level data
stacked_df <- data.frame()
# Order states by year_effective to ensure chronological processing
ordered_states <- filt_Corp %>%
filter(!is.na(year_effective)) %>%  # Only include states with a defined year_effective
filter(year_effective >= 1980 & year_effective <= 2018) %>%  # Keep only events between 1980 and 2018, removes IA and late switchers
arrange(year_effective) %>%
distinct(State_Acronym, year_effective)
# Loop through each state and its treatment year
for (i in seq_len(nrow(ordered_states))) {
# Define the state of interest and its treatment year
state_of_interest <- ordered_states$State_Acronym[i]
treatment_year <- ordered_states$year_effective[i]
# 1. Define the Treated Event for the current state
treatment_event <- filt_Corp %>%
filter(State_Acronym == state_of_interest & rel_year >= -4 & rel_year <= 4) %>%
mutate(treated = 1,  # Mark as treated
event_id = paste(state_of_interest, treatment_year, sep = "_"),
rel_year_did = rel_year)  # Unique event ID
# 2. Define the Clean Control Group
remaining_control <- filt_Corp %>%
filter(State_Acronym != state_of_interest) %>%  # Exclude treatment state
filter(is.na(year_effective) | year_effective > (treatment_year + 4)) %>%  # Exclude states with SSFA adoption within +4 years
# Additional Filters for Ohio
filter(!(State_Acronym == "OH" & year < 2008)) %>%  # Remove Ohio for all years prior to 2008, Oh always giving problems
filter(!(State_Acronym == "OH" & year_effective > 2004)) #
# Step (2): Keep only observations within the -4 to +4 year window relative to the treatment year
clean_control <- remaining_control %>%
filter(year >= (treatment_year - 4) & year <= (treatment_year + 4)) %>%
mutate(treated = 0,  # Mark as control
event_id = paste(state_of_interest, treatment_year, sep = "_"),
rel_year_did = year - treatment_year)  # Use same event ID
# Combine the treatment and control data for the current state’s event
event_data <- bind_rows(treatment_event, clean_control)
# Append the event data to the stacked dataframe
stacked_df <- bind_rows(stacked_df, event_data)
}
na_summary <- stacked_df %>%
summarize_all(~ sum(is.na(.)))
# View the summary to see where NA values are located
print(na_summary)
write.csv(stacked_df,"stacked__nci_DiD.csv",row.names=FALSE)
# Create a unique identifier for each year and event_id combination
stacked_df <- stacked_df %>%
mutate(year_event_id = paste(year, event_id, sep = "_"))
# Convert data to pdata.frame
stacked_df2 <- pdata.frame(stacked_df, index = c("event_id", "State_Acronym", "year"))
# Run model without interaction in plm
model_plm <- plm(
real_log_nci ~ treated + i(rel_year_did, ref = -1),  # No interaction term
data = stacked_df,
model = "within",  # Fixed-effects model
effect = "twoways"  # Include both "event_id" and "year_event_id"
)
# Run model without interaction in plm
model_plm <- plm(
real_log_nci ~ treated + i(rel_year_did, ref = -1),  # No interaction term
data = stacked_df2,
model = "within",  # Fixed-effects model
effect = "twoways"  # Include both "event_id" and "year_event_id"
)
summary(model_plm)
# Extract coefficients related to `rel_year_did`
tidy_model <- broom::tidy(model_plm)
# Filter only for the `rel_year_did` coefficients and add -1 as the reference year
plot_data <- tidy_model %>%
filter(grepl("rel_year_did", term)) %>%  # Keep only rel_year_did terms
mutate(
rel_year_did = as.numeric(gsub(".*\\)", "", term)),  # Extract year from term name
conf.low = estimate - 1.96 * std.error,  # Lower bound of 95% CI
conf.high = estimate + 1.96 * std.error   # Upper bound of 95% CI
)
# Check output
print(plot_data)
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of Treatment Effects by Relative Year",
x = "Relative Year",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_stata()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA by Relative Year",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_stata()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA by Relative Year",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_fivethirtyeight()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA by Relative Year",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_wsj()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA by Relative Year",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_stata()
# Plot
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
theme_stata()
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
scale_x_continuous(breaks = -4:4) +  # Ensure all event years from -4 to 4 appear on x-axis
theme_stata()
data <- data.frame(
State = c("Iowa", "Nebraska", "Michigan", "Illinois", "Oregon", "Georgia", "Wisconsin", "Arizona",
"Indiana", "Maine", "Minnesota", "Pennsylvania", "South Carolina", "Colorado", "California",
"Utah", "New Jersey", "New York", "Rhode Island", "Connecticut", "Louisiana", "North Carolina",
"North Dakota", "Delaware", "Kentucky", "Maryland", "Missouri", "Alabama", "Arkansas"),
`Year(-1)` = c(13.7310, 13.8293, 18.1627, 17.5258, 15.0442, 16.2897, 16.1089, 16.3625, 16.3236,
14.5600, 16.2077, 16.8691, 15.5964, 16.2108, 18.4513, 15.4087, 17.0194, 18.0420,
14.2395, 15.7927, 14.9694, 17.0966, 15.2282, 15.1121, 15.8495, 16.3124, 15.5912,
16.2669, 15.7918),
`Year(0)` = c(13.9013, 13.9194, 18.0320, 17.5959, 15.3944, 16.5132, 16.1409, 16.4651, 16.2676,
14.5376, 16.3070, 16.9461, 15.6462, 15.7781, 18.5046, 15.4155, 16.8805, 18.0867,
14.7394, 15.9562, 14.5785, 17.0988, 14.6874, 14.8556, 16.3406, 16.3431, 16.0250,
16.6749, 16.1156),
`Year(1)` = c(14.0784, 14.0081, 18.1141, 17.6680, 15.5267, 16.6460, 16.2741, 16.2364, 16.1857,
14.5412, 16.1780, 16.9036, 15.6484, 15.8665, 18.3144, 15.4587, 17.0485, 17.9796,
14.5387, 16.1150, 15.1079, 17.0437, 14.1607, 14.8901, 16.5404, 16.5736, 16.6588,
16.9298, 16.4554),
`Y(0) - Y(-1)` = c(0.1704, 0.0901, -0.1307, 0.0701, 0.3502, 0.2235, 0.0320, 0.1026, -0.0559,
-0.0224, 0.0993, 0.0771, 0.0498, -0.4327, 0.0533, 0.0068, -0.1388, 0.0447,
0.4999, 0.1635, -0.3909, 0.0022, -0.5408, -0.2565, 0.4911, 0.0307, 0.4339,
0.4080, 0.3238),
`Y(1) - Y(-1)` = c(0.3475, 0.1788, -0.0486, 0.1422, 0.4825, 0.3563, 0.1652, -0.1262, -0.1378, -0.0188,
-0.0297, 0.0346, 0.0520, -0.3443, -0.1368, 0.0499, 0.0292, -0.0623, 0.2992, 0.3223,
0.1385, -0.0529, -1.0674, -0.2220, 0.6909, 0.2612, 1.0676, 0.6629, 0.6636),
`Year Effective` = c(1978, 1988, 1991, 1999, 2004, 2006, 2006, 2007, 2007, 2007, 2007, 2007, 2007, 2009,
2011, 2011, 2012, 2015, 2015, 2016, 2016, 2016, 2016, 2017, 2018, 2018, 2020, 2021, 2021)
)
# View the data
print(data)
library(ggplot2)
# Assuming `data` is your dataframe
ggplot(data, aes(x = factor(Year), y = Log_CI, group = State, color = State)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Log(Corporate Income)", title = "Change in Log(Corporate Income) by State") +
theme_minimal()
library(reshape2)
# Reshape data to long format for plotting
data_long <- data %>%
pivot_longer(cols = starts_with("Year"),
names_to = "Year",
values_to = "Log_CI") %>%
mutate(Year = recode(Year,
"Year..1." = "Year -1",
"Year.0." = "Year 0",
"Year.1." = "Year 1"))
# Plot the line chart
ggplot(data_long, aes(x = Year, y = Log_CI, group = State, color = State)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Log(Corporate Income)", title = "Change in Log(Corporate Income) by State") +
theme_minimal()
# Filter for Year -1, Year 0, and Year 1 only
data_long_filtered <- data_long %>%
filter(Year %in% c("Year -1", "Year 0", "Year 1"))
# Plot the line chart
ggplot(data_long_filtered, aes(x = Year, y = Log_CI, group = State, color = State)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Log(Corporate Income)", title = "Change in Log(Corporate Income) by State") +
theme_minimal()
# Reshape the data for differences
data_diff <- data %>%
pivot_longer(cols = c("Y.0...Y..1.", "Y.1...Y..1."),
names_to = "Difference",
values_to = "Log_CI_Difference") %>%
mutate(Difference = recode(Difference,
"Y.0...Y..1." = "Y(0) - Y(-1)",
"Y.1...Y..1." = "Y(1) - Y(-1)"))
colnames(data)
data_diff <- data %>%
pivot_longer(cols = c("Y.0....Y..1.", "Y.1....Y..1."),
names_to = "Difference",
values_to = "Log_CI_Difference") %>%
mutate(Difference = recode(Difference,
"Y.0....Y..1." = "Y(0) - Y(-1)",
"Y.1....Y..1." = "Y(1) - Y(-1)"))
# Plot the change-in-change bar chart
ggplot(data_diff, aes(x = State, y = Log_CI_Difference, fill = Difference)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "State", y = "Difference in Log(Corporate Income)", title = "Yearly Differences in Log(Corporate Income) by State") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Plot a grouped bar chart
ggplot(data_long, aes(x = State, y = Log_CI, fill = Year)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "State", y = "Log(Corporate Income)", title = "Log(Corporate Income) by State and Year") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Plot a grouped bar chart
ggplot(data_long_filtered, aes(x = State, y = Log_CI, fill = Year)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "State", y = "Log(Corporate Income)", title = "Log(Corporate Income) by State and Year") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Creating the data_estimates dataframe in R
data_estimates <- data.frame(
State = c("Arizona", "Colorado",
"Michigan", "Illinois", "Oregon",
"Nebraska", "Minnesota", "Utah",
"Georgia", "Wisconsin", "Indiana", "Maine", "Pennsylvania", "South Carolina",
"California", "New Jersey", "New York",
"Rhode Island", "Connecticut", "Louisiana", "North Carolina", "Kentucky", "Missouri",
"North Dakota", "Delaware", "Maryland"),
SR_Estimate = c(0.01873, 0.01618,
0.00224, 0.11045, 0.13223,
-0.01958, -0.11023, -0.02099,
-0.19896, -0.23165, -0.64051, -0.12710, -0.13765, -0.16904,
-0.27194, -0.07802, -0.00058,
0.15475, 0.25046, 0.01182, 0.04647, 0.23948, 0.52780,
-0.34955, -0.32371, -0.01044),
SR_Delta_Percent = c(1.89065, 1.63116,
0.22425, 11.67805, 14.13708,
-1.93896, -10.43719, -2.07712,
-18.04173, -20.67763, -47.29764, -11.93544, -12.85964, -15.55249,
-23.81000, -7.50541, -0.05798,
16.73661, 28.46162, 1.18901, 4.75667, 27.05883, 69.51988,
-29.49947, -27.65400, -1.03857),
LR_Estimate = c(0.22250, 0.33630,
-1.23610, -0.42870, -0.03540,
0.20450, 0.00610, 0.51340,
-0.11590, -0.25650, -0.89030, -0.15510, -0.35020, -0.22710,
-0.22390, -0.47160, -0.17000,
NA, NA, NA, NA, NA, NA,
NA, NA, NA),
LR_Delta_Percent = c(24.91958, 39.97589,
-70.94850, -34.86447, -3.47807,
22.69115, 0.61186, 67.09628,
-10.94357, -22.62450, -58.94674, -14.36705, -29.54528, -20.31589,
-20.06049, -37.59969, -15.63352,
NA, NA, NA, NA, NA, NA,
NA, NA, NA),
Group = c("Positive SR & LR", "Positive SR & LR",
"Positive SR & Negative LR", "Positive SR & Negative LR", "Positive SR & Negative LR",
"Negative SR & Positive LR", "Negative SR & Positive LR", "Negative SR & Positive LR",
"Negative SR & LR", "Negative SR & LR", "Negative SR & LR", "Negative SR & LR", "Negative SR & LR", "Negative SR & LR",
"Negative SR & LR", "Negative SR & LR", "Negative SR & LR",
"Positive SR, < 6 yr LR", "Positive SR, < 6 yr LR", "Positive SR, < 6 yr LR",
"Positive SR, < 6 yr LR", "Positive SR, < 6 yr LR", "Positive SR, < 6 yr LR",
"Negative SR, < 6 yr LR", "Negative SR, < 6 yr LR", "Negative SR, < 6 yr LR")
)
# Example data preparation
data_long_estimates <- data_estimates %>%
pivot_longer(cols = c(SR_Estimate, SR_Delta_Percent, LR_Estimate, LR_Delta_Percent),
names_to = "Measure", values_to = "Value") %>%
mutate(Category = case_when(
Measure == "SR_Estimate" ~ "Short-Run Estimate",
Measure == "SR_Delta_Percent" ~ "Short-Run Δ %",
Measure == "LR_Estimate" ~ "Long-Run Estimate",
Measure == "LR_Delta_Percent" ~ "Long-Run Δ %"
))
ggplot(data_long_estimates, aes(x = State, y = Value, fill = Category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~ Group, scales = "free", ncol = 2) +
labs(x = "State", y = "Estimate / Δ %", title = "Corporate Income Point Estimates by Group") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(plot_data, aes(x = rel_year_did, y = estimate)) +
geom_point() +
geom_line() +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "Stacked Difference-in-Differences Plot of SSFA",
x = "Event Time",
y = "Estimated Effect on Log(Corporate Income)"
) +
scale_x_continuous(breaks = -4:4) +  # Ensure all event years from -4 to 4 appear on x-axis
theme_minimal()
ggplot(data_long_filtered, aes(x = Year, y = Log_CI, group = State, color = State)) +
geom_line() +
geom_point() +
labs(x = "Year", y = "Log(Corporate Income)", title = "Change in Log(Corporate Income) by State- Short Run") +
theme_stata()
# Plot the change-in-change bar chart
ggplot(data_long_filtered, aes(x = State, y = Log_CI_Difference, fill = Difference)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "State", y = "Difference in Log(Corporate Income)", title = "Yearly Differences in Log(Corporate Income) by State") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
# Plot the change-in-change bar chart
ggplot(data_long_filtered, aes(x = State, y = Log_CI_Difference, fill = Difference)) +
geom_bar(stat = "identity", position = "dodge") +
labs(x = "State", y = "Difference in Log(Corporate Income)", title = "Yearly Differences in Log(Corporate Income) by State") +
theme_stata() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(data_long_estimates, aes(x = State, y = Value, fill = Category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~ Group, scales = "fixed", ncol = 2) +  # Use "fixed" scales for consistent y-axis
labs(x = "State", y = "Estimate / Δ %", title = "Corporate Income Point Estimates by Group") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(data_long_estimates, aes(x = State, y = Value, fill = Category)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~ Group, scales = "free_x", ncol = 2) +  # "free_x" keeps separate x-axes but uniform y-axis
labs(x = "State", y = "Estimate / Δ %", title = "Corporate Income Point Estimates by Group") +
scale_y_continuous(limits = c(-80, 80)) +  # Set a uniform y-axis range across all facets
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
