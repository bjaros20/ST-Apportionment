#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
library(boot)
library(ggthemes)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load data
naive_ci<-read.csv("naive_ci.csv")
#Create base dataframe that has log_ci as dependent variable.
filt_Corp <-log_nci %>%
select(State_Acronym,year,year_effective,State_Name,log_ci,Post)
#Create base dataframe that has log_ci as dependent variable.
filt_Corp <-naive_ci %>%
select(State_Acronym,year,year_effective,State_Name,log_ci,Post)
View(filt_Corp)
str(filt_Corp)
#attempt to get just the descriptive statistics
# Sort the dataframe by year_effective
sorted_df <- filt_Corp %>%
arrange(year_effective)
# Filter for the first 29 states by year_effective
first_29_states <- sorted_df %>%
distinct(State_Name, year_effective) %>%
slice(1:29) %>%
pull(State_Name)
# Filter the main dataframe for the first 29 states
filtered_df <- sorted_df %>%
filter(State_Name %in% first_29_states)
# Pull the log_ci values for year_effective - 1, year_effective, and year_effective + 1
log_ci_values <- filtered_df %>%
filter(year %in% c(year_effective - 1, year_effective, year_effective + 1)) %>%
select(State_Name, year, log_ci) %>%
arrange(State_Name, year)
# Display the result
print(log_ci_values)
View(log_ci_values)
# Sort the dataframe by year_effective and select the first 29 states
sorted_df <- your_dataframe %>%
arrange(year_effective)
# Get the first 29 states and their year_effective
state_years <- sorted_df %>%
distinct(State_Name, year_effective) %>%
slice(1:29)
# Create an empty dataframe to store the results
result_df <- data.frame()
# Loop over the first 29 states
for (i in 1:nrow(state_years)) {
state_name <- state_years$State_Name[i]
year_eff <- state_years$year_effective[i]
# Filter the dataframe for the current state and the 3 relevant years
temp_df <- sorted_df %>%
filter(State_Name == state_name,
year %in% c(year_eff - 1, year_eff, year_eff + 1)) %>%
select(State_Name, year, log_ci)
# Append the result to the result_df
result_df <- rbind(result_df, temp_df)
}
# Display the final result
print(result_df)
# Now create wide DF
# Pivot the dataframe to wider format
transposed_df <- result_df %>%
mutate(year_relative = case_when(
year == year_effective - 1 ~ "year(-1)",
year == year_effective ~ "year(0)",
year == year_effective + 1 ~ "year(1)"
)) %>%
select(State_Name, year_relative, log_ci) %>%
pivot_wider(names_from = year_relative, values_from = log_ci)
result_df_with_effective <- result_df %>%
left_join(sorted_df %>% select(State_Name, year_effective) %>% distinct(),
by = "State_Name")
# Now create wide DF
# Pivot the dataframe to wider format
transposed_df <- result_df_with_effective %>%
mutate(year_relative = case_when(
year == year_effective - 1 ~ "year(-1)",
year == year_effective ~ "year(0)",
year == year_effective + 1 ~ "year(1)"
)) %>%
select(State_Name, year_relative, log_ci) %>%
pivot_wider(names_from = year_relative, values_from = log_ci)
# Display the transposed result
print(transposed_df)
View(transposed_df)
diff <- transposed_df %>%
mutate(diff1 = `year(0)`- `year(-1)`) %>%
mutate(diff2 = `year(1)`- `year(-1)`)
View(diff)
write.csv(diff, "sr_descriptive_log_ci.csv",row.names = FALSE)
year_diff <- diff %>%
left_join(sorted_df %>% select(State_Name, year_effective) %>% distinct(),
by = "State_Name")
View(year_diff)
print(year_diff)
print(
year_diff %>%
mutate(across(where(is.numeric), ~ format(.x, nsmall = 4))),
n = Inf
)
print(
year_diff %>%
mutate(across(where(is.numeric), ~ round(.x, nsmall = 4))),
n = Inf
)
write.csv(year_diff, "sr_descriptive_log_ci.csv",row.names = FALSE)
print(
year_diff %>%
mutate(across(where(is.numeric), ~ round(.x, 4))),
n = Inf
)
print(
year_diff %>%
mutate(across(where(is.numeric), ~ formatC(.x, format = "f", digits = 4))),
n = Inf
)
