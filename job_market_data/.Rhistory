#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
library(cli)
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(boot)
library(ggthemes)
library(kernlab)
library(Synth)
library(tidysynth)
# install.packages("devtools")
devtools::install_github("edunford/tidysynth")
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Laod data
naive_ci<-read.csv("naive_ci.csv")
real_CI <- naive_ci%>%
mutate(real_ci = (naive_ci/CPI_def)*100)
#Create base dataframe that has nat_share as dependent variable.
Filter_frac <-real_CI %>%
select(State_Acronym,year,year_effective,State_Name,real_ci,Post)
not_yet_treated <- Filter_frac %>%
group_by(State_Name)%>%
filter(Post == 1 & year_effective > 2021)
never_treated <- Filter_frac %>%
group_by(State_Name)%>%
filter(Post == 0 & year_effective >2021 | is.na( year_effective)) %>%
filter(!(State_Acronym == "OH"))
control <- rbind(never_treated,not_yet_treated) %>%
distinct(State_Name)
Illinois <- Filter_frac %>%
filter(State_Name == "Illinois" | State_Name %in% control$State_Name)
# synthetic control
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE)
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE)
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate the fitted weights for the synthetic control
generate_weights(optimization_window = 1976:1999,  # Time to use in the optimization task
margin_ipop = .02,
sigf_ipop = 7,
bound_ipop = 6  # Optimizer options
) %>%
generate_control()
View(naive_ci)
View(naive_ci)
Filter_frac <-real_CI %>%
select(State_Acronym,year,year_effective,State_Name,real_ci,Post,logRealCitRev,population)
not_yet_treated <- Filter_frac %>%
group_by(State_Name)%>%
filter(Post == 1 & year_effective > 2021)
never_treated <- Filter_frac %>%
group_by(State_Name)%>%
filter(Post == 0 & year_effective >2021 | is.na( year_effective)) %>%
filter(!(State_Acronym == "OH"))
control <- rbind(never_treated,not_yet_treated) %>%
distinct(State_Name)
#Create Treatment dataframe for just Illinois
#Create Illinois Panel from Illinois and control
Illinois <- Filter_frac %>%
filter(State_Name == "Illinois" | State_Name %in% control$State_Name)
# synthetic control
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate predictors (you can adjust these as needed)
generate_predictor(time_window = 1976:1999,
logRealCitRev = mean(logRealCitRev), na.rm = TRUE)  # required to put one predictor. Log (CIT_REV)
%>%
# synthetic control
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate predictors (you can adjust these as needed)
generate_predictor(time_window = 1976:1999,
logRealCitRev = mean(logRealCitRev), na.rm = TRUE) %>%  # required to put one predictor. Log (CIT_REV)
# Generate the fitted weights for the synthetic control
generate_weights(optimization_window = 1976:1999,  # Time to use in the optimization task
margin_ipop = .02,
sigf_ipop = 7,
bound_ipop = 6  # Optimizer options
) %>%
generate_control()
Illinois %>%
group_by(State_Name) %>%
summarise(variance = var(logRealCitRev, na.rm = TRUE)) %>%
filter(variance == 0)
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate predictors (you can adjust these as needed)
generate_predictor(time_window = 1976:1999,
population = mean(population), na.rm = TRUE) %>%  # required to put one predictor. population
# Generate the fitted weights for the synthetic control
generate_weights(optimization_window = 1976:1999,  # Time to use in the optimization task
margin_ipop = .02,
sigf_ipop = 7,
bound_ipop = 6  # Optimizer options
) %>%
generate_control()
Illinois %>%
group_by(State_Name) %>%
summarise(variance = var(population, na.rm = TRUE)) %>%
filter(variance == 0)
# synthetic control
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate predictors (you can adjust these as needed)
generate_predictor(time_window = 1976:1999,
population = mean(population, na.rm = TRUE)) %>%  # required to put one predictor. population
# Generate the fitted weights for the synthetic control
generate_weights(optimization_window = 1976:1999,  # Time to use in the optimization task
margin_ipop = .02,
sigf_ipop = 7,
bound_ipop = 6  # Optimizer options
) %>%
generate_control()
plot(illinois_sc)
View(illinois_sc)
summary(illinois_sc)
synthetic_values <- illinois_sc$synthetic_control
View(illinois_sc)
illinois_sc$.synthetic_control
synthetic_values <- illinois_sc$.synthetic_control
original_data <- illinois_sc$.original_data
print(original_data)
plot_data <- original_data %>%
select(year, real_ci)
View(original_data)
illinois_sc %>% plot_trends()
real_CI_cap <- real_CI %>%
mutate(real_ci_cap = real_ci/population)
illinois_sc %>% plot_differences()
illinois_sc %>% plot_weights()
#Create base dataframe that has nat_share as dependent variable.
Filter_frac <-real_CI_cap %>%
select(State_Acronym,year,year_effective,State_Name,real_ci_cap,Post,logRealCitRev,population)
#Create Treatment dataframe for just Illinois
#Create Illinois Panel from Illinois and control
Illinois <- Filter_frac %>%
filter(State_Name == "Illinois" | State_Name %in% control$State_Name)
# synthetic control
illinois_sc <- Illinois %>%
synthetic_control(outcome = real_ci_cap,
unit = State_Name,
time= year,
i_unit = "Illinois",
i_time = 1999,
generate_placebos = TRUE) %>%
# Generate predictors (you can adjust these as needed)
generate_predictor(time_window = 1976:1999,
population = mean(population, na.rm = TRUE)) %>%  # required to put one predictor. population
# Generate the fitted weights for the synthetic control
generate_weights(optimization_window = 1976:1999,  # Time to use in the optimization task
margin_ipop = .02,
sigf_ipop = 7,
bound_ipop = 6  # Optimizer options
) %>%
generate_control()
illinois_sc %>% plot_trends()
illinois_sc %>% plot_differences()
illinois_sc %>% plot_weights()
