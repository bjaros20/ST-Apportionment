#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load Detrended, per capita, real revenue data
Rev <- read.csv("detrend_per_capita.csv")
View(Rev)
#Remove X and X.1, REMOVE COLUMN when saving
#note, row names =FALSE did not work, still have an X
Rev <- Rev %>%
select(-X,-X.1)
View(Rev)
devtools::install_github("synth-inference/synthdid")
library(synthdid)
View(Rev)
Ind <-Rev %>%
filter(State_Acronym="IN")
Ind <-Rev %>%
filter(State_Acronym=="IN")
Control <- Rev %>%
filter(year_effective>2014 | is.na())
Control <- Rev %>%
filter(year_effective>2014 | is.na(year_effective))
View(Control)
df <- Indiana %>%
bind_rows(Control)
df <- Ind %>%
bind_rows(Control)
Ind %>%
mutate(syn_treat=1)
View(Ind)
View(df)
#Now want to filter the df to just be until 2014
df2 <- df %>%
filter(year<=2014)
View(df2)
#Now I think it is ready for Archangelsky DiD
# Load tobacco sales in long panel format.
data("df2")
#Now I think it is ready for Archangelsky DiD
# Load tobacco sales in long panel format.
data(df2)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
setup <- panel.matrices(df2, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
sum(is.na(df2))
filter_total <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
sum(is.na(filter_total))
unique_states <- unique(filter_total$State_Acronym)
year_range <- range(filter_total$year)
complete_grid <- expand.grid(
State_Acronym = unique(filter_total$State_Acronym),
year = seq(min(filter_total$year), max(filter_total$year))
)
View(complete_grid)
# Merge with the complete grid
balanced_panel <- complete_grid %>%
left_join(filter_total, by = c("State_Acronym", "year"))
# Fill missing values using LOCF
balanced_panel <- balanced_panel %>%
group_by(State_Acronym) %>%
arrange(State_Acronym, year) %>%
fill(everything(), .direction = "down") %>%
fill(everything(), .direction = "up") %>%
ungroup()
sum(is.na(balanced_panel))
#check every state has an entry for every year
balance_check <- table(balanced_panel$State_Acronym, balanced_panel$year)
print(balance_check)
library(fixest)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
View(filter_total)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
#setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
setup <- panel.matrices(filter_total)
source("~/Documents/GitHub/ST-Apportionment/job_market_data/SynDiD.R", echo=TRUE)
sum(is.na(filter_total))
print(filter_total)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
#setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
setup <- panel.matrices(filter_total)
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
#setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
setup <- panel.matrices(filter_total,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
sum(is.na(filter_total))
str(filter_total)
sum(is.na(filter_total$real_totRev_capita))
sum(is.na(filter_total$real_treatment))
sum(is.na(filter_total$State_Acronym))
sum(is.na(filter_total$year))
# Transform to N*T matrix format required for synthdid,
# where N is the number of units and T the time periods.
#setup <- panel.matrices(filter_total, unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
setup <- panel.matrices(filter_total,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
