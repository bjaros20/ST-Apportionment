library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load Detrended, per capita, real revenue data
Rev <- read.csv("detrend_per_capita.csv")
Rev <- Rev %>%
select(-X,-X.1)
str(Rev)
#Table
Table(Rev$State_Name,Rev$year_effective)
#Table
table(Rev$State_Name,Rev$year_effective)
#Table
list(Rev$State_Name,Rev$year_effective)
#Table
table(Rev$State_Name,Rev$year_effective)
#Load year effective data cleanly:
library(xlsx)
SSFA <- read.xlsx("ssfa_data_jmp.xlsx")
#Load year effective data cleanly:
install.packages("xlsx")
library(xlsx)
SSFA <- read.xlsx("ssfa_data_jmp.xlsx")
library(readxl)
SSFA <- read.xlsx("ssfa_data_jmp.xlsx")
SSFA <- read.xls("ssfa_data_jmp.xlsx")
SSFA <- read_excel("ssfa_data_jmp.xlsx")
SSFA <- read_excel("job_market_data/ssfa_data_jmp.xlsx")
View(SSFA)
str(SSFA)
Switch <- SSFA %>%
select(state,year_effective)
View(Switch)
Switch <- SSFA %>%
select(state,year_effective) %>%
arrange(year_effective)
View(Switch)
View(Switch)
View(Rev)
# Run sDiD package -Archangelsky- Just Iowa
#switch before 2014.  Merge back together
Iowa <-Rev %>%
filter(State_Acronym=="IA")
View(Iowa)
Control <- Rev %>%
filter(year_effective>1991 | is.na(year_effective))
df <- Iowa %>%
bind_rows(Control)
#Now want to filter the df to just be until 1991
df2 <- df %>%
filter(year<=1991)
#filter down to smaller df
filter_total2 <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
View(filter_total2)
#filter down to smaller df
IA_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(IA_rtr_cap)
#sDiD
Iowa_totrev <- panel.matrices(IA_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
View(IA_rtr_cap)
View(Switch)
View(IA_rtr_cap)
#need Iowa to be treated
IA_rtr_cap_treat %>%
filter(State_Acronym="IA",year>=1978)%>%
mutate(treatment=1)
#need Iowa to be treated
IA_treat <-IA_rtr_cap %>%
filter(State_Acronym="IA",year>=1978)%>%
mutate(treatment=1)
#need Iowa to be treated
IA_treat <-IA_rtr_cap %>%
filter(State_Acronym=="IA",year>=1978)%>%
mutate(treatment=1)
#need Iowa to be treated
IA_treat <-IA_rtr_cap %>%
group_by(State_Acronym=="IA",year>=1978)%>%
mutate(treatment=1) %>%
ungroup()
View(IA_treat)
str(IA_rtr_cap)
#need Iowa to be treated
IA_treat <- IA_rtr_cap %>%
mutate(treatment = if_else(State_Acronym == "IA" & year >= 1978, 1, treatment))
View(IA_treat)
#sDiD
Iowa_totrev <- panel.matrices(IA_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
#sDiD
Iowa_totrev <- panel.matrices(IA_treat,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
#Error running sDiD, so need to mutate columns:
IA_treat <- IA_treat %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_totRev_capita),
treatment = as.integer(treatment)
)
str(IA_treat)
#sDiD
Iowa_totrev <- panel.matrices(IA_treat,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
tau.hat = synthdid_estimate(Iowa_totrev$Y, Iowa_totrev$N0, Iowa_totrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -6.89"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-109.20, 95.43)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Iowa = Treated")
#Summary stats for Iowa Syn control group
print(summary(tau.hat))
#Compare the SynDiD to other estimators, set-up
tau.sc   = sc_estimate(Iowa_totrev$Y, Iowa_totrev$N0, Iowa_totrev$T0)
tau.did  = did_estimate(Iowa_totrev$Y, Iowa_totrev$N0, Iowa_totrev$T0)
estimates = list(tau.did, tau.sc, tau.hat)
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#print estimate differences:
print(unlist(estimates))
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Iowa")
#spaghetti plots, includes all states for just Indiana
estimate = synthdid_estimate(Iowa_totrev$Y, Iowa_totrev$N0, Iowa_totrev$T0)
top.controls = synthdid_controls(estimate)[1:10, , drop=FALSE]
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Iowa")
#[1] "95% CI (-109.20, 95.43)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Iowa = Treated")
#Summary stats for Iowa Syn control group
print(summary(tau.hat))
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Iowa")
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Iowa")
View(df2)
# Now do it for CIT
#filter down to smaller df
IA_rtr_cap <- df2 %>%
select(State_Acronym,year,real_CIT_capita,treatment)
# Now do it for CIT
#filter down to smaller df
IA_rtr_cap <- df2 %>%
select(State_Acronym,year,real_cit_capita,treatment)
# Now do it for CIT
#filter down to smaller df
IA_cit_cap <- df2 %>%
select(State_Acronym,year,real_cit_capita,treatment)
#check data is balanced
is.pbalanced(IA_cit_cap)
#need Iowa to be treated
IA_cit_treat <- IA_cit_cap %>%
mutate(treatment = if_else(State_Acronym == "IA" & year >= 1978, 1, treatment))
#Error running sDiD, so need to mutate columns:
IA_cit_treat <- IA_cit_treat %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_totRev_capita),
treatment = as.integer(treatment)
)
#Error running sDiD, so need to mutate columns:
IA_cit_treat <- IA_cit_treat %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_cit_capita),
treatment = as.integer(treatment)
)
#sDiD
Iowa_cit_treat <- panel.matrices(IA_cit_treat,unit = "State_Acronym", time = "year", outcome = "real_cit_capita", treatment = "treatment")
tau.hat = synthdid_estimate(IA_cit_treat$Y, IA_cit_treat$N0, IA_cit_treat$T0)
tau.hat = synthdid_estimate(Iowa_cit_treat$Y, Iowa_cit_treat$N0, Iowa_cit_treat$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -6.89"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-109.20, 95.43)"
plot(tau.hat)+labs(x="Year",y="Real CIT Revenue per Capita") + ggtitle("Synthetic DiD Plot- Iowa = Treated")
View(SSFA)
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load Detrended, per capita, real revenue data
Rev <- read.csv("detrend_per_capita.csv")
#Remove X and X.1, REMOVE COLUMN when saving
#note, row names =FALSE did not work, still have an X
Rev <- Rev %>%
select(-X,-X.1)
write.csv("detrend_per_capita.csv",row.names = FALSE)
write.csv(Rev,"detrend_per_capita.csv",row.names = FALSE)
View(Rev)
library(readxl)
SSFA <- read_excel("job_market_data/ssfa_data_jmp.xlsx")
SSFA <- read_excel("ssfa_data_jmp.xlsx")
View(SSFA)
str(SSFA)
select(state,year_effective,type) %>%
arrange(year_effective)
# Get just retroactive states
Retro <- SSFA %>%
select(state,year_effective,type,retroactive) %>%
filter(retroactive=="yes")%>%
arrange(year_effective)
View(Retro)
# Run sDiD package -Archangelsky- Just Iowa
#switch before 1991, 3 years post switch.  Tight window
Maine <-Rev %>%
filter(State_Acronym=="ME")
View(Maine)
Control <- Rev %>%
filter(year_effective>1991 | is.na(year_effective))%>%
filter(State_Acronym != "NH" & State_Acronym != "ME")
View(Control)
df <- Maine %>%
bind_rows(Control)
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010)
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
Control <- Rev %>%
filter(year_effective>1991 | is.na(year_effective))%>%
filter(State_Acronym != "NH" & State_Acronym != "ME" & State_Acronym != "AK" & State_Acronym != "HA")
df <- Maine %>%
bind_rows(Control)
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010)
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(ME_rtr_cap)
View(df2)
View(ME_rtr_cap)
#sDiD
Maine_totrev <- panel.matrices(ME_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010) %>%
filter(year_effective>2010 | is.na(year_effective))
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(ME_rtr_cap)
#sDiD
Maine_totrev <- panel.matrices(ME_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
View(ME_rtr_cap)
Control <- Rev %>%
filter(year_effective>2010 | is.na(year_effective))%>%
filter(State_Acronym != "NH" & State_Acronym != "ME" & State_Acronym != "AK" & State_Acronym != "HA")
df <- Maine %>%
bind_rows(Control)
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010)
View(df2)
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#sDiD
Maine_totrev <- panel.matrices(ME_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
tau.hat = synthdid_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -6.89"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-109.20, 95.43)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Maine= Treated")
#Summary of control group
print(summary(tau.hat))
Control <- Rev %>%
filter(year_effective>2010 | is.na(year_effective))%>%
filter(State_Acronym != "NH" & State_Acronym != "MA" & State_Acronym != "AK" & State_Acronym != "HA")
df <- Maine %>%
bind_rows(Control)
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010)
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(ME_rtr_cap)
#sDiD
Maine_totrev <- panel.matrices(ME_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
tau.hat = synthdid_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -21.97"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-194.94, 151.01)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Maine= Treated")
#Summary of control group
print(summary(tau.hat))
tau.sc   = sc_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
tau.did  = did_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
estimates = list(tau.did, tau.sc, tau.hat)
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#print estimate differences:
print(unlist(estimates))
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Maine")
#spaghetti plots, includes all states for just Indiana
estimate = synthdid_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
top.controls = synthdid_controls(estimate)[1:10, , drop=FALSE]
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Maine")
Control <- Rev %>%
filter(year_effective>2010 | is.na(year_effective))%>%
filter(State_Acronym != "NH" & State_Acronym != "MA" & State_Acronym != "AK" & State_Acronym != "HI")
df <- Maine %>%
bind_rows(Control)
#Now want to filter the df to just be until 2010 (switch was in 2007)
df2 <- df %>%
filter(year<=2010)
#filter down to smaller df
ME_rtr_cap <- df2 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(ME_rtr_cap)
#sDiD
Maine_totrev <- panel.matrices(ME_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
tau.hat = synthdid_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -18.68"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-275.04, 237.67)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Maine= Treated")
#Summary of control group
print(summary(tau.hat))
#Compare the SynDiD to other estimators, set-up
tau.sc   = sc_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
tau.did  = did_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
estimates = list(tau.did, tau.sc, tau.hat)
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#print estimate differences:
print(unlist(estimates))
# Diff-in-Diff      Synthetic Control Synthetic Diff-in-Diff
#  39.53032              -13.94932              -18.68179
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Maine")
#spaghetti plots, includes all states for just Indiana
estimate = synthdid_estimate(Maine_totrev$Y, Maine_totrev$N0, Maine_totrev$T0)
top.controls = synthdid_controls(estimate)[1:10, , drop=FALSE]
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Maine")
#NEXT STATE Connecticut in 2016
Conn <-Rev %>%
filter(State_Acronym=="CT")
Control1 <- Rev %>%
filter(year_effective>2019 | is.na(year_effective))%>%
filter(State_Acronym != "RI" & State_Acronym != "MA" & State_Acronym != "AK" & State_Acronym != "HI" & State_Acronym != "NY")
Conn2 <- Conn %>%
bind_rows(Control1)
View(Conn2)
#Now want to filter the df to just be until 2019 (switch was in 2016)
Conn3 <- Conn2 %>%
filter(year<=2019)
View(Conn3)
#filter down to smaller df
CT_rtr_cap <- Conn3 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(CT_rtr_cap)
na_rows <- CT_rtr_cap %>%
filter(is.na(State_Acronym) | is.na(year) | is.na(real_totRev_capita) | is.na(treatment))
# Print the rows that contain NA values
print(na_rows)
complete_panel <- CT_rtr_cap %>%
select(State_Acronym, year) %>%
distinct() %>%
complete(State_Acronym, year)
# Identify rows in the complete panel that are missing in the original data
missing_rows <- complete_panel %>%
anti_join(CT_rtr_cap, by = c("State_Acronym", "year"))
# Print the missing rows
print(missing_rows)
Control1 <- Rev %>%
filter(year_effective>2019 | is.na(year_effective))%>%
filter(State_Acronym != "RI" & State_Acronym != "MA" & State_Acronym != "OH" & State_Acronym != "AK" & State_Acronym != "HI" & State_Acronym != "NY")
Conn2 <- Conn %>%
bind_rows(Control1)
#Now want to filter the df to just be until 2019 (switch was in 2016)
Conn3 <- Conn2 %>%
filter(year<=2019)
#filter down to smaller df
CT_rtr_cap <- Conn3 %>%
select(State_Acronym,year,real_totRev_capita,treatment)
#check data is balanced
is.pbalanced(CT_rtr_cap)
#sDiD
CT_totrev <- panel.matrices(CT_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
View(CT_rtr_cap)
View(SSFA)
# For some reason the treatment column doesn't have CT, but it has it in the post column
#need Iowa to be treated
CT_rtr_cap %>%
mutate(treatment = if_else(State_Acronym == "CT" & year >= 2016, 1, treatment))
#sDiD
CT_totrev <- panel.matrices(CT_rtr_cap,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
# For some reason the treatment column doesn't have CT, but it has it in the post column
#need Iowa to be treated
CT_treat <-CT_rtr_cap %>%
mutate(treatment = if_else(State_Acronym == "CT" & year >= 2016, 1, treatment))
View(CT_treat)
#sDiD
CT_totrev <- panel.matrices(CT_treat,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
warnings()
str(CT_treat)
CT_treat <- CT_treat %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_totRev_capita),
treatment = as.integer(treatment)
)
#sDiD
CT_totrev <- panel.matrices(CT_treat,unit = "State_Acronym", time = "year", outcome = "real_totRev_capita", treatment = "treatment")
tau.hat = synthdid_estimate(CT_totrev$Y, CT_totrev$N0, CT_totrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -25.10"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-288.61, 238.40)"
plot(tau.hat)+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Plot- Connecticut= Treated")
#Summary of control group
print(summary(tau.hat))
#Compare the SynDiD to other estimators, set-up
tau.sc   = sc_estimate(CT_totrev$Y, CT_totrev$N0, CT_totrev$T0)
tau.did  = did_estimate(CT_totrev$Y, CT_totrev$N0, CT_totrev$T0)
estimates = list(tau.did, tau.sc, tau.hat)
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#print estimate differences:
print(unlist(estimates))
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Connecticut")
#spaghetti plots, includes all states for just Maine
estimate = synthdid_estimate(CT_totrev$Y, CT_totrev$N0, CT_totrev$T0)
top.controls = synthdid_controls(estimate)[1:10, , drop=FALSE]
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real Total Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Connecticut")
str(df2)
#CIT for Maine
#filter down to smaller df
ME_cit_cap <- df2 %>%
select(State_Acronym,year,real_cit_capita,treatment)
source("~/Documents/GitHub/ST-Apportionment/job_market_data/retroactive_sDiD.R", echo=TRUE)
#check data is balanced
is.pbalanced(ME_cit_cap)
ME_treat2 <- ME_cit_cap %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_totRev_capita),
treatment = as.integer(treatment)
)
ME_treat2 <- ME_cit_cap %>%
mutate(
State_Acronym = as.character(State_Acronym),
year = as.integer(year),
real_totRev_capita = as.numeric(real_cit_capita),
treatment = as.integer(treatment)
)
#sDiD
Maine_citrev <- panel.matrices(ME_treat2,unit = "State_Acronym", time = "year", outcome = "real_cit_capita", treatment = "treatment")
tau.hat = synthdid_estimate(Maine_citrev$Y, Maine_citrev$N0, Maine_citrev$T0)
se = sqrt(vcov(tau.hat, method='placebo'))
sprintf('point estimate: %1.2f', tau.hat)
#[1] "point estimate: -25.10"
sprintf('95%% CI (%1.2f, %1.2f)', tau.hat - 1.96 * se, tau.hat + 1.96 * se)
#[1] "95% CI (-288.61, 238.40)"
plot(tau.hat)+labs(x="Year",y="Real CIT Revenue per Capita") + ggtitle("Synthetic DiD Plot- Maine= Treated")
#[1] "95% CI (-288.61, 238.40)"
plot(tau.hat)+labs(x="Year",y="Real CIT Revenue per Capita") + ggtitle("Synthetic DiD Plot- Maine= Treated- Corporate Inc")
#Summary of control group
print(summary(tau.hat))
#Compare the SynDiD to other estimators, set-up
tau.sc   = sc_estimate(Maine_citrev$Y, Maine_citrev$N0, Maine_citrev$T0)
tau.did  = did_estimate(Maine_citrev$Y, Maine_citrev$N0, Maine_citrev$T0)
estimates = list(tau.did, tau.sc, tau.hat)
names(estimates) = c('Diff-in-Diff', 'Synthetic Control', 'Synthetic Diff-in-Diff')
#print estimate differences:
print(unlist(estimates))
#the plots relative to each other
synthdid_plot(estimates, se.method='placebo')+labs(x="Year",y="Real CIT Revenue per Capita") + ggtitle("DiD v. Syn Control v. Syn DiD Plot- Syn Maine CI")
#spaghetti plots, includes all states for just Maine
estimate = synthdid_estimate(Maine_citrev$Y, Maine_citrev$N0, Maine_citrev$T0)
top.controls = synthdid_controls(estimate)[1:10, , drop=FALSE]
plot(estimate, spaghetti.units=rownames(top.controls)) + labs(x="Year",y="Real CIT Revenue per Capita") + ggtitle("Synthetic DiD Spaghetti Plot- Maine CI")
