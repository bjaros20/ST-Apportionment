#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
library(boot)
library(ggthemes)
# set seed
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load data
NCI <- read.csv("real_NCI_cap.csv")
fed_data <-read.csv("FCTAX.csv")
View(NCI)
library(lubridate)
View(fed_data)
#filter fed_data, convert date to year
fed_data <- mutate(fed_data$DATE, year = year(DATE))
fed_data <-read.csv("FCTAX.csv")
#filter fed_data, convert date to year
fed_data <- mutate(fed_data$DATE, year = year(DATE))
fed_data <- fed_data %>%
mutate(DATE = as.Date(DATE), year = year(DATE))
View(fed_data)
fed_data <-read.csv("FCTAX.csv")
View(fed_data)
# Convert the DATE column to a Date class
fed_year <- fed_data %>%
mutate(DATE = as.Date(DATE), year = year(DATE))
View(fed_year)
View(fed_year)
head(fed_data$DATE)
fed_year <- fed_data %>%
mutate(DATE = as.Date(DATE, format = "%m/%d/%y"),
year = year(DATE))
View(fed_year)
View(fed_data)
# Convert the DATE column to a Date class
fed_year <- fed_data %>%
mutate(DATE = as.Date(DATE, format = "%m/%d/%y"),
year = ifelse(year(DATE) >= 2024, year(DATE) - 100, year(DATE)))
View(fed_year)
fed_year2 <-fed_year %>%
filter(year> 1975)
View(fed_year2)
filt_year <- fed_year2 %>%
select(FCTAX,rate,year)
naive_fci <-filt_year %>%
mutate(naive_fed_ci = ((FCTAX/rate)*100))
View(naive_fci)
bill_naive_fci <- filt_year %>%
mutate(bill_nfci = naive_fci * 1000000000)
View(naive_fci)
View(bill_naive_fci)
bill_naive_fci <- filt_year %>%
mutate(bill_nfci = naive_fed_ci * 1000000000)
bill_naive_fci <- naive_fci  %>%
mutate(bill_nfci = naive_fed_ci * 1000000000)
View(bill_naive_fci)
select(year,Ann_CORPINC)
ungroup()
state_nci <- NCI %>%
group_by(State_Acronym) %>%
select(year,Ann_CORPINC) %>%
ungroup()
View(state_nci)
state_nci <- NCI %>%
group_by(State_Acronym) %>%
select(year,Ann_CORPINC) %>%
filter(State_Acronym = "AL")
#Get state corporate Naive income
state_nci <- NCI %>%
group_by(State_Acronym) %>%
select(year,Ann_CORPINC) %>%
filter(State_Acronym == "AL")
ungroup()
View(NCI)
#Get state corporate Naive income
state_nci <- NCI %>%
group_by(State_Acronym) %>%
select(year,Ann_CORPINC,CPI_def) %>%
filter(State_Acronym == "AL")
ungroup()
state_nci2 <-state_nci %>%
select(year,Ann_CORPINC,CPI_def) %>%
mutate(thou)
state_nci2 <-state_nci %>%
select(year,Ann_CORPINC,CPI_def) %>%
mutate(naive_sci = Ann_CORPINC * 1000)
View(state_nci2)
View(bill_naive_fci)
# left join
join <- bill_naive_fci %>%
full_join(state_nci2, by = c(year))
join <- bill_naive_fci %>%
full_join(state_nci2, by = c(year=year))
str(bill_naive_fci)
state_nci2
join <- bill_naive_fci %>%
full_join(state_nci2, by = c("year"))
View(join)
# left join
join <- bill_naive_fci %>%
full_join(state_nci2, by = c("year")) %>%
select(-State_Acronym)
View(join)
#create real Federal and State Naive CI, Base year is 1983-1984
real_ci <- join %>%
mutate(real_fci = (bill_nfci/CPI_def)*100) %>%
mutate(real_sci = state_nci2/CPI_def)*100)
#create real Federal and State Naive CI, Base year is 1983-1984
real_ci <- join %>%
mutate(real_fci = (bill_nfci/CPI_def)*100) %>%
mutate(real_sci = (state_nci2/CPI_def)*100)
rlang::last_trace()
#create real Federal and State Naive CI, Base year is 1983-1984
real_ci <- join %>%
mutate(real_fci = (bill_nfci/CPI_def)*100) %>%
mutate(real_sci = (state_nci2/CPI_def)*100)
real_ci <- join %>%
mutate(real_fci = (bill_nfci/CPI_def)*100) %>%
mutate(real_sci = (naive_sci/CPI_def)*100)
View(real_ci)
aw Federal CI v State CI
# Raw Federal CI v State CI
plot1 <- ggplot(real_ci, aes(x = year)) +
#geom_vline(xintercept = year_effective_first, color = "black", linewidth = .75) +
geom_line(aes(y = real_fci, color = "Federal CI"), size = 1.2) +
geom_line(aes(y = real_sci, color = "State CI"), linetype = "dotdash", size = 1.2) +
labs(title = paste("Federal vs. Total State Naive Corporate Income"),
x = "Year",
y = "Real Corporate Income ($)") +
scale_color_manual(values = c("Federal CI" = "red", "Synthetic" = "blue"),
labels = c("Federal CI" = Federal CI), "State CI" = Total State CI)) +
plot1 <- ggplot(real_ci, aes(x = year)) +
#geom_vline(xintercept = year_effective_first, color = "black", linewidth = .75) +
geom_line(aes(y = real_fci, color = "Federal CI"), size = 1.2) +
geom_line(aes(y = real_sci, color = "State CI"), linetype = "dotdash", size = 1.2) +
labs(title = paste("Federal vs. Total State Naive Corporate Income"),
x = "Year",
y = "Real Corporate Income ($)") +
scale_color_manual(values = c("Federal CI" = "red", "Synthetic" = "blue"),
labels = c("Federal CI" = Federal CI, "State CI" = Total State CI)) +
# Raw Federal CI v State CI
plot1 <- ggplot(real_ci, aes(x = year)) +
# geom_vline(xintercept = year_effective_first, color = "black", linewidth = .75) +
geom_line(aes(y = real_fci, color = "Federal CI"), size = 1.2) +
geom_line(aes(y = real_sci, color = "State CI"), linetype = "dotdash", size = 1.2) +
labs(title = "Federal vs. Total State Naive Corporate Income",
x = "Year",
y = "Real Corporate Income ($)") +
scale_color_manual(values = c("Federal CI" = "red", "State CI" = "blue"),
labels = c("Federal CI" = "Federal CI", "State CI" = "State CI")) +
guides(color = guide_legend(title = "Corporate Income Type")) +
theme_stata()
print(plot1)
View(naive_fci)
View(NCI)
View(real_ci)
write.csv(real_ci,"fed_state_ci.csv"row.names=FALSE)
write.csv(real_ci,"fed_state_ci.csv",row.names=FALSE)
View(real_ci)
View(NCI)
