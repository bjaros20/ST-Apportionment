#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Create a loop for the bls employment results by state
#Load Packages
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(did) # for running DiD
library(plm)
library(lmtest)
library(synthdid)
library(fixest)
library(boot)
library(ggthemes)
set.seed(26)
#JMP Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
filter_bls <-read.csv("bls_post.csv")
View(filter_bls)
Rev <- read.csv("detrend_per_capita.csv")
View(Rev)
str(Rev)
View(filter_bls)
#Want jobs per capita, so going to get population by state from Rev and merge
pop <- Rev %>%
select(State_Name,population)
#Left join
bls_pop <- filter_bls %>%
left_join(pop,by=c("State_Name"))
View(bls_pop)
str(filter_bls)
#Want jobs per capita, so going to get population by state from Rev and merge
pop <- Rev %>%
select(State_Name,population,year)
#Left join
bls_pop <- filter_bls %>%
left_join(pop,by=c("State_Name","year"))
bls_pop
str(bls_pop)
colnames(bls_pop)
bls_per_cap <- bls_pop %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ . / population))
bls_per_cap <- bls_pop %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ ifelse(is.numeric(.) & is.numeric(population), . / population, NA)))
View(bls_per_cap)
#Get jobs by per capita, keeps original column names,
bls_per_cap <- bls_pop %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ if_else(is.numeric(population) & !is.na(population), . / population, NA_real_)))
#Get jobs by per capita, keeps original column names,
bls_per_cap <- bls_pop %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ suppressWarnings(as.numeric(.) / as.numeric(population))))
View(bls_per_cap)
bls_pop %>% bls_pop %>%
mutate(population=population*1000)
bls_pop <- bls_pop %>%
mutate(population=population*1000)
View(bls_pop)
bls_per_cap <- bls_pop %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ suppressWarnings(as.numeric(.) / as.numeric(population))))
View(bls_per_cap)
write.csv(bls_per_cap,"jobs_per_cap.csv")
library(pracma)
safe_detrend <- function(x) {
if (length(x) > 1) {
return(pracma::detrend(x, tt = "linear"))
} else {
return(rep(NA, length(x)))  # Return NA for groups that can't be detrended
}
}
#detrend results
safe_detrend <- function(x) {
if (length(na.omit(x)) > 1) {  # Ensure detrending is only attempted on non-NA values
return(detrend(x, tt = "linear"))
} else {
return(rep(NA, length(x)))  # Return NA for groups that can't be detrended
}
}
bls_detrend <- bls_per_cap %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ suppressWarnings(safe_detrend(as.numeric(.)))))
View(bls_detrend)
View(bls_per_cap)
bls_detrend <- bls_per_cap %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ safe_detrend(as.numeric(.))))
View(bls_detrend)
safe_detrend <- function(x) {
print(length(na.omit(x)))  # Debugging: Print length of non-NA values
if (length(na.omit(x)) > 1) {
return(detrend(x, tt = "linear"))
} else {
return(rep(NA, length(x)))
}
}
bls_detrend <- bls_per_cap %>%
mutate(across(c(Totalemploymentnumberofjobs, Wageandsalaryemployment, Proprietorsemployment,
Farmproprietorsemployment, Nonfarmproprietorsemployment2, Farmemployment,
Nonfarmemployment, Privatenonfarmemployment, Forestryfishingandrelatedactivities,
Miningquarryingandoilandgasextraction, Utilities, Construction, Manufacturing,
Wholesaletrade, Retailtrade, Transportationandwarehousing, Information,
Financeandinsurance, Realestateandrentalandleasing,
Professionalscientificandtechnicalservices, Managementofcompaniesandenterprises,
Administrativeandsupportandwastemanagementandremediationservices, Educationalservices,
Healthcareandsocialassistance, Artsentertainmentandrecreation, Accommodationandfoodservices,
Otherservicesexceptgovernmentandgovernmententerprises, Governmentandgovernmententerprises,
Federalcivilian, Military, Stateandlocal, Stategovernment, Localgovernment),
~ safe_detrend(as.numeric(.))))
View(bls_detrend)
Simple_reg <- lm(Totalemploymentnumberofjobs ~ Post + factor(year) + factor(State_Name), data = bls_per_cap)
summary(Simple_reg)
# I can try and break those coefficients up by state
# Interaction Reg (with interaction between Post and state)
Interaction_reg <- lm(Totalemploymentnumberofjobs~ Post * factor(State_Name) + factor(year), data = bls_per_cap
# I can try and break those coefficients up by state
# Interaction Reg (with interaction between Post and state)
Interaction_reg <- lm(Totalemploymentnumberofjobs~ Post * factor(State_Name) + factor(year), data=bls_per_cap)
# I can try and break those coefficients up by state
# Interaction Reg (with interaction between Post and state)
Interaction_reg <- lm(Totalemploymentnumberofjobs~ Post * factor(State_Name) + factor(year), data = bls_per_cap)
summary(Interaction_reg)
bls_detrend <-bls_per_cap %>%
filter(!is.na(Wageandsalaryemployment) & Wageandsalaryemployment != "(D)" &
!is.na(Manufacturing) & Manufacturing != "(D)" &
!is.na(Totalemploymentnumberofjobs) & !is.na(Post) &
!is.na(year) & !is.na(state_name)) %>%
mutate(Totalemploymentnumberofjobs = as.numeric(Totalemploymentnumberofjobs),
Manufacturing = as.numeric(Manufacturing),
Wageandsalaryemployment = as.numeric(Wageandsalaryemployment)) %>%
group_by(State_Acronym) %>%
mutate(de_tot_jobs = safe_detrend(Totalemploymentnumberofjobs),
de_man_jobs = safe_detrend(Manufacturing),
de_salary = safe_detrend(Wageandsalaryemployment)) %>%
ungroup()
bls_detrend <-bls_per_cap %>%
filter(!is.na(Wageandsalaryemployment) & Wageandsalaryemployment != "(D)" &
!is.na(Manufacturing) & Manufacturing != "(D)" &
!is.na(Totalemploymentnumberofjobs) & !is.na(Post) &
!is.na(year) & !is.na(State_name)) %>%
mutate(Totalemploymentnumberofjobs = as.numeric(Totalemploymentnumberofjobs),
Manufacturing = as.numeric(Manufacturing),
Wageandsalaryemployment = as.numeric(Wageandsalaryemployment)) %>%
group_by(State_Acronym) %>%
mutate(de_tot_jobs = safe_detrend(Totalemploymentnumberofjobs),
de_man_jobs = safe_detrend(Manufacturing),
de_salary = safe_detrend(Wageandsalaryemployment)) %>%
ungroup()
View(bls_per_cap)
bls_detrend <-bls_per_cap %>%
filter(!is.na(Wageandsalaryemployment) & Wageandsalaryemployment != "(D)" &
!is.na(Manufacturing) & Manufacturing != "(D)" &
!is.na(Totalemploymentnumberofjobs) & !is.na(Post) &
!is.na(year) & !is.na(State_Name)) %>%
mutate(Totalemploymentnumberofjobs = as.numeric(Totalemploymentnumberofjobs),
Manufacturing = as.numeric(Manufacturing),
Wageandsalaryemployment = as.numeric(Wageandsalaryemployment)) %>%
group_by(State_Acronym) %>%
mutate(de_tot_jobs = safe_detrend(Totalemploymentnumberofjobs),
de_man_jobs = safe_detrend(Manufacturing),
de_salary = safe_detrend(Wageandsalaryemployment)) %>%
ungroup()
#Estimate these regressions via Simple Regression
Simple_reg_de<- lm(de_tot_jobs ~ Post + factor(year) + factor(State_Name), data = bls_detrend)
summary(Simple_reg_de)
# I can try and break those coefficients up by state
# Interaction Reg (with interaction between Post and state)
Interaction_reg_de<- lm(de_tot_jobs~ Post * factor(State_Name) + factor(year), data = bls_detrend)
summary(Interaction_reg_de)
# Create a vector with the specified column names
selected_columns <- c(
"Totalemploymentnumberofjobs",
"Wageandsalaryemployment",
"Proprietorsemployment",
"Farmproprietorsemployment",
"Nonfarmproprietorsemployment2",
"Farmemployment",
"Nonfarmemployment",
"Privatenonfarmemployment",
"Forestryfishingandrelatedactivities",
"Miningquarryingandoilandgasextraction",
"Utilities",
"Construction",
"Manufacturing",
"Wholesaletrade",
"Retailtrade",
"Transportationandwarehousing",
"Information",
"Financeandinsurance",
"Realestateandrentalandleasing",
"Professionalscientificandtechnicalservices",
"Managementofcompaniesandenterprises",
"Administrativeandsupportandwastemanagementandremediationservices",
"Educationalservices",
"Healthcareandsocialassistance",
"Artsentertainmentandrecreation",
"Accommodationandfoodservices",
"Otherservicesexceptgovernmentandgovernmententerprises",
"Governmentandgovernmententerprises",
"Federalcivilian",
"Military",
"Stateandlocal",
"Stategovernment",
"Localgovernment"
)
