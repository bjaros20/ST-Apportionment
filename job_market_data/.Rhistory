#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Nebraska or "Direct Switchers DiD Approach"
#Run DiD with all the Direct Switchers (NE, MO, MS, CO, RI, ND, DE)
#Control Group is all States that Did not Switch by 2007.
#this includes: AK, HI, KS, NM, OK.  AL and MT between 2008-now became "Step
#-wise" switchers.  FL and MA had DWS over the whole period 1976-2022.
library(tidyr)
library(dplyr)
library(tidyverse)
# for robust standard error estimation
library(lmtest)
# To calculate correct vcov matrix with 2WFE
library(multiwayvcov)
# For a package way to do FE
library(plm)
#Fixest
install.packages("fixest")
library(fixest)
#Load Data Tables in R
install.packages("data.table")
# Get rate of change for tax bases and find elasticity of tax base w.r.t apportionment and rate changes.
#Redo Callaway and Sant'Anna From Summer
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST_Apportionment/Rates_Of_Change")
#Elasticity Results for All the Tax Bases
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
#New Directory
setwd("~/Documents/GitHub/ST-Apportionment/job_market_data")
#Load data for Elasticity JMP
Elas <-read.csv("elasticity_data_jmp.csv")
View(Elas)
#then Merge the rates to run the Three Way FE:
rates <-read_xlsx("stateCIT_rates_1976_2023 copy.xlsx")
View(rates)
#start with formatting
class(rates)
str(rates)
#install stingr package
install.packages(stringr)
install.packages("stringr")
library(stringr)
str_remove_all(rates," ")
View(rates)
rates_1976_2002 <- rates %>% select(`1976`:`2002`)
# Create Dataframe for Elasticity results for All the Tax Bases
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(lmtest)
library(caret)
library(ggplot2)
rates_1976_2002 <- rates %>% select(`1976`:`2002`)
rates_1976_2002 <- rates %>% select(1976:2002)
colnames(rates)
rates_1976_2002 <- rates %>% select("1976 ":"2002 ")
#Space after the year for 1976 through 2002.
nospace_rate <- as.data.frame(
apply(rates,2, function(x) gsub("\\s+", "", x)))
View(nospace_rate)
#it ran, so will try again.
str_remove_all(nospace_rate," ")
#Space after the year for 1976 through 2002.
nospace_rate <- as.data.frame(
apply(rates,2, function(x) gsub(" ", "", x)))
#it ran, so will try again.
str_remove_all(nospace_rate,"\ ")
View(nospace_rate)
#Space after the year for 1976 through 2002.
nospace_rate <- as.data.frame(
apply(rates,2, function(x) gsub("\ ", "", x)))
View(nospace_rate)
#it ran, so will try again.
str(nospace_rate)
View(nospace_rate)
View(rates)
glimpse(rates)
rates_rem_space <- rates %>%
mutate(across(1976:2002, ~ str_remove(., "^ ")))
rates_rem_space <- rates %>%
mutate(across( 1976: 2002, ~ str_remove(., "^ ")))
#Will need to first remove the leading space from the columns:
colnames(rates) <- str_trim(colnames(rates))
cols_to_modify <- colnames(rates)[grepl("^(1976|1977|1978|1979|1980|1981|1982|1983|1984|1985|1986|1987|1988|1989|1990|1991|1992|1993|1994|1995|1996|1997|1998|1999|2000|2001|2002)$", colnames(rates))]
rates_rem_space <- rates %>%
mutate(across(all_of(cols_to_modify), ~ str_remove(., "^ ")))
#Try again but will try to remove the first space from the character columns:
rates_rem_space <- rates %>%
mutate(across(all_of(cols_to_modify), ~ str_remove(., "^ ")))
View(rates_rem_space)
#Try again but will try to remove the first space from the character columns:
rates_rem_space <- rates %>%
mutate(across(all_of(cols_to_modify), ~ str_remove(., "^ ")))
glimpse((rates_rem_space))
#didn't work, try again, by forcing the numeric conversion
rates_rem_space <- rates %>%
mutate(across(.cols = -State, .fns = ~ as.numeric(trimws(.))))
dplyr::last_dplyr_warnings()
rates_rem_space <- rates %>%
mutate(across(.cols = -State, .fns = ~ parse_number(trimws(.))))
# Check the structure of the cleaned data
glimpse(rates_rem_space)
View(rates_rem_space)
glimpse(rates_rem_space)
class(rates_rem_space)
str(rates_rem_space)
View(rates_rem_space)
#save this clean rates dataframe
write.csv(rates_rem_space,"clean_rates_1976-2022.csv")
Elas2 <- Elas %>%
mutate(rate)
#this worked, all of the columns in rates_rem_space are numeric.
rates_cleaned <- rates %>%
mutate(across(.cols = `1976`:`2002`, .fns = ~ as.numeric(trimws(.))))
# Check the structure of the cleaned data to confirm conversion
glimpse(rates_cleaned)
View(rates_cleaned)
#this worked, all of the columns in rates_rem_space are numeric.
rates_cleaned <- rates_rem_space %>%
mutate(across(.cols = `1976`:`2002`, .fns = ~ as.numeric(trimws(.))))
# Check the structure of the cleaned data to confirm conversion
glimpse(rates_cleaned)
View(rates)
View(rates_cleaned)
glimpse(rates_cleaned)
View(rates_cleaned)
write.csv(rates_cleaned,"rates_jmp.csv")
view(Elas)
glimpse(Elas)
rates_long <- rates_cleaned %>%
pivot_longer(cols = `1976`:`2023`, names_to = "year", values_to = "rate") %>%
mutate(year = as.integer(year))
View(rates_long)
#use an inner join to merge Elas and rates_long
Elas2 <- Elas %>%
inner_join(Elas,rates_long,by=c("state"="State","year"))
Elas2 <- Elas %>%
inner_join(rates_long,by=c("state"="State","year"="year"))%>%
rename(rates=rate)
View(Elas2)
#save as Elasticity and Rate Data for JMP
write(Elas2,"elasticity_rates_jmp.csv")
#save as Elasticity and Rate Data for JMP
write.csv(Elas2,"elasticity_rates_jmp.csv")
