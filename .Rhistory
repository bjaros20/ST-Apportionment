#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
Census State and Local Data- Tax Foundation
# Census State and Local Data- Tax Foundation
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("tidyverse")
install.packages("xlsx")
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(xlsx)
#Attempt to Get Revenue in R
install.packages("readxl")
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
library(readxl)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
#set working directory
Setwd("~/Documents/GitHub/ST-Apportionment")
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment")
#Load Apportionment Document
All_App_df <-read.csv("SalesFactorWeights_ALLStates.csv")
#Load Apportionment Document
All_App_df <-read_xls("SalesFactorWeights_ALLStates.xls")
#Load Apportionment Document
All_App_df <-read_xlsx("SalesFactorWeights_ALLStates.xlsx")
#Load Apportionment Document
All_App_df <-read_csv("SalesFactorWeights_ALLStates.csv")
View(All_App_df)
CIT_Rev_df <-read.csv("SCIT_Rev_Long.csv")
View(CIT_Rev_df)
New_Panel <-read.csv("new_state_year_panel.csv")
View(New_Panel)
View(New_Panel)
#Make Revenue Log Column
CIT_Rev_df$Log_Revenue <-log(CIT_Rev_df$Revenue)
View(CIT_Rev_df)
View(CIT_Rev_df)
CIT_Rev_Year <-subset(CIT_Rev_df,Year >=1976 & Year <=2007)
View(CIT_Rev_Year)
All_App_Year <-subset(All_App_df,Year >=1976 & Year <=2007)
All_App_Year <-subset(All_App_df,year >=1976 & year <=2007)
View(All_App_Year)
#UpperCaseYear
All_App_Year$Year <- toupper(All_App_Year$Year)
# Assuming CIT_Rev_Year has a State column with U.S. state abbreviations
# If not, replace it with your actual column name
# Create a mapping of state abbreviations to full names
state_mapping <- data.frame(StateAbbrev = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"),
StateFullName = c("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"))
# Merge CIT_Rev_Year with the state mapping to add a StateFullName column
CIT_Rev_Year <- merge(CIT_Rev_Year, state_mapping, by.x = "State", by.y = "StateAbbrev", all.x = TRUE)
View(CIT_Rev_Year)
colnames(All_App_Year)[colnames(All_App_Year) == "year"] <- "Year"
colnames(All_App_Year)[colnames(All_App_Year) == "State"] <- "StateFullName"
colnames(All_App_Year)[colnames(All_App_Year) == "state"] <- "StateFullName"
merged_df <- merge(CIT_Rev_Year, All_App_Year, by = c("StateFullName", "Year"))
View(merged_df)
merged_df <- subset(merged_df, select = -State)
# Assuming "StateFullName" is the column you want to rename
colnames(merged_df)[colnames(merged_df) == "StateFullName"] <- "State"
# Assuming merged_df is the data frame you want to save
write.csv(merged_df, file = "NE_DiD_Set_up.csv", row.names = FALSE)
#Load Cleaned Set-up
Clean_Set-up <-read_csv("NE_DiD_Set_up.csv")
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment")
#Load Cleaned Set-up
Clean_Set-up <-read_csv("NE_DiD_Set_up.csv")
#Load Cleaned Set-up
Clean_Set-up <-read.csv("NE_DiD_Set_up.csv")
#Load Cleaned Set-up
Clean_Set_up <-read.csv("NE_DiD_Set_up.csv")
View(Clean_Set_up)
#Sort Into TreatMent and Control Groups
Just_NE <- subset(Clean_Set_up, State == "Nebraska")
View(Just_NE)
#Remove Region and Number
Clean_Set_up <- subset(Clean_Set_up, select = -c(Region, Number))
#Sort Into TreatMent and Control Groups
Just_NE <- subset(Clean_Set_up, State == "Nebraska")
#Create Control Group
Control_Df <- subset(Clean_Set_up, sales == 33.34)
View(Just_NE)
View(Control_Df)
#Create Control Group
Control_Df <- Clean_Set_up %>%
group_by(State) %>%
filter(all(sales == 33.34))
View(Control_Df)
View(Just_NE)
View(Control_Df)
#Attempt to Get DiD_ Nebraska
install.packages("fixest")
install.packages("ggplot2")
install.packages("ggplot2")
library(fixest)
library(ggplot2)
# Add a binary treatment indicator to both dataframes
Just_NE <- Just_NE %>%
mutate(Treatment = ifelse(State == "Nebraska" & Year >= 1988 & Year <= 1992, 1, 0))
install.packages("tidyr")
install.packages("dplyr")
install.packages("did")
install.packages("tidyverse")
install.packages("lmtest")
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment")
#Load Cleaned Set-up
Clean_Set_up <-read.csv("NE_DiD_Set_up.csv")
#Remove Region and Number
Clean_Set_up <- subset(Clean_Set_up, select = -c(Region, Number))
#Sort Into TreatMent and Control Groups
Just_NE <- subset(Clean_Set_up, State == "Nebraska")
#Create Control Group
Control_Df <- Clean_Set_up %>%
group_by(State) %>%
filter(all(sales == 33.34))
library(fixest)
library(ggplot2)
library(tidyr)
library(dplyr)
library(did)
library(tidyverse)
library(lmtest)
# Add a binary treatment indicator to both dataframes
Just_NE <- Just_NE %>%
mutate(Treatment = ifelse(State == "Nebraska" & Year >= 1988 & Year <= 1992, 1, 0))
Control_df <- Control_df %>%
mutate(Treatment = 0)  # Control group has a Treatment indicator of 0
#set working directory
setwd("~/Documents/GitHub/ST-Apportionment")
#Load Cleaned Set-up
Clean_Set_up <-read.csv("NE_DiD_Set_up.csv")
#Remove Region and Number
Clean_Set_up <- subset(Clean_Set_up, select = -c(Region, Number))
#Sort Into TreatMent and Control Groups
Just_NE <- subset(Clean_Set_up, State == "Nebraska")
#Create Control Group
Control_Df <- Clean_Set_up %>%
group_by(State) %>%
filter(all(sales == 33.34))
Just_NE <- Just_NE %>%
mutate(Treatment = ifelse(State == "Nebraska" & Year >= 1988 & Year <= 1992, 1, 0))
Control_df <- Control_Df %>%
mutate(Treatment = 0)  # Control group has a Treatment indicator of 0
# Combine dataframes
combined_data <- bind_rows(Just_NE, Control_df)
# Run two-way fixed effects model
# Assuming "Revenue" is the outcome variable
did_model <- feols(Revenue ~ Treatment + i(Year, ref = c(-1, -1000)) | State + Year, data = combined_data)
# Run two-way fixed effects model
# Assuming "Revenue" is the outcome variable
did_model <- feols(Revenue ~ Treatment | State + i(Year, ref = -1), data = combined_data)
# Run two-way fixed effects model
# Assuming "Revenue" is the outcome variable
did_model <- feols(Revenue ~ Treatment | State + Year, data = combined_data)
# Display the results
summary(did_model)
View(did_model)
# Create DiD plot
did_plot <- ggplot(combined_data, aes(x = Year, y = Revenue, color = factor(Treatment))) +
geom_line(aes(group = State), linetype = "dashed", alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Difference-in-Differences Plot",
x = "Year",
y = "Revenue") +
theme_minimal()
# Display the plot
print(did_plot)
# Create DiD plot
did_plot <- ggplot(combined_data, aes(x = Year, y = Revenue, color = factor(Treatment))) +
geom_line(aes(group = State, linetype = factor(State)), alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Difference-in-Differences Plot",
x = "Year",
y = "Revenue") +
theme_minimal()
# Display the plot
print(did_plot)
# Create DiD plot
did_plot <- ggplot(combined_data, aes(x = Year, y = Revenue, color = factor(Treatment), linetype = factor(State))) +
geom_line(alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Difference-in-Differences Plot",
x = "Year",
y = "Revenue") +
theme_minimal()
# Display the plot
print(did_plot)
# Create DiD plot
did_plot2 <- ggplot(combined_data, aes(x = Year, y = Revenue, color = factor(Treatment), linetype = factor(ifelse(State == "NE", "NE", "Control")))) +
geom_line(alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Difference-in-Differences Plot",
x = "Year",
y = "Revenue") +
theme_minimal()
# Display the plot
print(did_plot2)
View(combined_data)
# Create plot for Log_Revenue
log_revenue_plot <- ggplot(combined_data, aes(x = Year, y = Log_Revenue, color = factor(ifelse(State == "NE", "NE", "Control")))) +
geom_line(alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Log_Revenue Difference-in-Differences Plot",
x = "Year",
y = "Log_Revenue") +
theme_minimal()
# Display the plot
print(log_revenue_plot)
# Create plot for Log_Revenue with separate colors for Nebraska and Control
log_revenue_plot <- ggplot(combined_data, aes(x = Year, y = Log_Revenue, color = factor(ifelse(State == "NE", "NE", "Control")))) +
geom_line(aes(group = State), linetype = "dashed", alpha = 0.5) +
geom_smooth(aes(group = Treatment), method = "lm", se = FALSE) +
labs(title = "Log_Revenue Difference-in-Differences Plot",
x = "Year",
y = "Log_Revenue") +
theme_minimal()
# Display the plot
print(log_revenue_plot)
# Create plot for Log_Revenue with a clear distinction between Nebraska and Control
plot_data <- combined_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
ggplot(plot_data, aes(x = Year, y = mean_Log_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
labs(title = "Log_Revenue Difference-in-Differences Plot",
x = "Year",
y = "Mean Log_Revenue") +
theme_minimal()
# Create plot for Log_Revenue with a clear distinction between Nebraska and Control
plot_data <- combined_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
ggplot(plot_data, aes(x = Year, y = mean_Log_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Log_Revenue Difference-in-Differences Plot",
x = "Year",
y = "Mean Log_Revenue") +
theme_minimal()
# Create plot for Revenue with a clear distinction between Nebraska and Control
plot_data_revenue <- combined_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Revenue = mean(Revenue),
se_Revenue = sd(Revenue) / sqrt(n()),
upper = mean_Revenue + (-1.96 * se_Revenue),
lower = mean_Revenue + (1.96 * se_Revenue))
ggplot(plot_data_revenue, aes(x = Year, y = mean_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Revenue Difference-in-Differences Plot",
x = "Year",
y = "Mean Revenue") +
theme_minimal()
#Create New Midwest Control Group
midwest_states <- c("Illinois", "Indiana", "Iowa", "Kansas", "Michigan", "Minnesota", "Missouri", "Nebraska", "North Dakota", "Ohio", "South Dakota", "Wisconsin")
# Filter the Clean_Set_Up df for Midwest states
midwest_data <- Clean_Set_Up %>%
filter(State %in% midwest_states)
# Create plot for Log_Revenue with a clear distinction between Nebraska and Control
plot_data_midwest <- midwest_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
midwest_data <- Clean_Set_Up %>%
filter(State %in% c("Illinois", "Indiana", "Iowa", "Kansas", "Michigan", "Minnesota", "Missouri", "Nebraska", "North Dakota", "Ohio", "South Dakota", "Wisconsin"))
# Filter the Clean_Set_Up df for Midwest states
midwest_data <- Clean_Set_up %>%
filter(State %in% midwest_states)
#Midwest DiD Plots:
# Create plot for Log_Revenue with a clear distinction between Nebraska and Control
plot_data_midwest <- midwest_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
ggplot(plot_data_midwest, aes(x = Year, y = mean_Log_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Log_Revenue Difference-in-Differences Plot",
x = "Year",
y = "Mean Log_Revenue") +
theme_minimal()
# Create plot for "sales" with a clear distinction between Nebraska and Control
plot_data_midwest_sales <- midwest_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_sales = mean(sales),
se_sales = sd(sales) / sqrt(n()),
upper = mean_sales + (-1.96 * se_sales),
lower = mean_sales + (1.96 * se_sales))
ggplot(plot_data_midwest_sales, aes(x = Year, y = mean_sales, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Sales Difference-in-Differences Plot",
x = "Year",
y = "Mean Sales") +
theme_minimal()
# Create plot for Revenue with a clear distinction between Nebraska and Control
plot_data_midwest_revenue <- midwest_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Revenue = mean(Revenue),
se_Revenue = sd(Revenue) / sqrt(n()),
upper = mean_Revenue + (-1.96 * se_Revenue),
lower = mean_Revenue + (1.96 * se_Revenue))
ggplot(plot_data_midwest_revenue, aes(x = Year, y = mean_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Revenue Difference-in-Differences Plot",
x = "Year",
y = "Mean Revenue") +
theme_minimal()
# Create plot for Revenue with a clear distinction between Nebraska and Control
plot_data_midwest_revenue <- midwest_data %>%
mutate(group = factor(ifelse(State == "Nebraska", "Nebraska", "Control"))) %>%
group_by(group, Year) %>%
summarize(mean_Revenue = mean(Revenue),
se_Revenue = sd(Revenue) / sqrt(n()),
upper = mean_Revenue + (-1.96 * se_Revenue),
lower = mean_Revenue + (1.96 * se_Revenue))
ggplot(plot_data_midwest_revenue, aes(x = Year, y = mean_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Midwest Control Group Revenue DiD Plot",
x = "Year",
y = "Mean Revenue") +
theme_minimal()
# Grouping the states into three groups
Three_groups_df <- Clean_Set_up %>%
mutate(group = case_when(
State == "Nebraska" ~ "Nebraska",
all(sales == 33.34) ~ "Sales_equal_33.34",
TRUE ~ "Other_states"
))
# Display the structure of the new dataframe
str(Three_groups_df)
View(Three_groups_df)
# Grouping the states into three groups
Three_groups_df <- Clean_Set_up %>%
group_by(State) %>%
mutate(group = case_when(
State == "Nebraska" ~ "Nebraska",
all(sales == 33.34) ~ "Sales_equal_33.34",
TRUE ~ "Other_states"
)) %>%
ungroup()
# Display the structure of the new dataframe
str(Three_groups_df)
# Assuming "Three_groups_df" is the dataframe for three groups
plot_data_three_groups <- Three_groups_df %>%
group_by(group, Year) %>%
summarize(mean_Revenue = mean(Revenue),
se_Revenue = sd(Revenue) / sqrt(n()),
upper = mean_Revenue + (-1.96 * se_Revenue),
lower = mean_Revenue + (1.96 * se_Revenue))
# Create plot for Three-Groups-DiD
ggplot(plot_data_three_groups, aes(x = Year, y = mean_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Three-Groups-DiD",
x = "Year",
y = "Mean Revenue") +
theme_minimal()
# Assuming "Three_groups_df" is the dataframe for three groups
plot_data_three_groups <- Three_groups_df %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
# Create plot for Three-Groups-DiD - Log_Revenue
ggplot(plot_data_three_groups, aes(x = Year, y = mean_Log_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Three-Groups-DiD - Log_Revenue",
x = "Year",
y = "Mean Log_Revenue") +
theme_minimal()
# Assuming "Three_groups_df" is the dataframe for three groups
plot_data_three_groups_filtered <- Three_groups_df %>%
filter(State != "Texas") %>%
group_by(group, Year) %>%
summarize(mean_Log_Revenue = mean(Log_Revenue),
se_Log_Revenue = sd(Log_Revenue) / sqrt(n()),
upper = mean_Log_Revenue + (-1.96 * se_Log_Revenue),
lower = mean_Log_Revenue + (1.96 * se_Log_Revenue))
# Create plot for Three-Groups-DiD - Log_Revenue (filtered)
ggplot(plot_data_three_groups_filtered, aes(x = Year, y = mean_Log_Revenue, color = group)) +
geom_pointrange(aes(ymin = lower, ymax = upper), size = 1) +
geom_line(aes(group = group), linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = c(1988, 1992), linetype = "dotted", color = "black") +
labs(title = "Three-Groups-DiD - Log_Revenue (Excluding Texas)",
x = "Year",
y = "Mean Log_Revenue") +
theme_minimal()
